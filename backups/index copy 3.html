<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Operational AI Systems. Deployed in 48 hours. Defense & Critical Infrastructure.">
    <title>AIME | Defense-Grade Automation</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Rajdhani:wght@400;600;700&family=Syncopate:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* =================================================================
           AIME 3.0 // HYPER-REALITY ENGINE
           ================================================================= */
        :root {
            --void: #030304;
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-highlight: rgba(255, 255, 255, 0.15);

            /* Dynamic Neons */
            --primary: #00FF41;
            --primary-glow: rgba(0, 255, 65, 0.4);
            --secondary: #008F11;
            --alert: #FF2A2A;
            --alert-glow: rgba(255, 42, 42, 0.5);

            --font-display: 'Syncopate', sans-serif;
            --font-tech: 'Rajdhani', sans-serif;
            --font-body: 'Inter', sans-serif;

            --ease-out: cubic-bezier(0.215, 0.61, 0.355, 1);
        }

        /* MODE OVERRIDES (Keeps your logic intact) */
        body.mode-tech { --primary: #00F0FF; --primary-glow: rgba(0, 240, 255, 0.5); }
        body.mode-crisis { --primary: #FFB000; --primary-glow: rgba(255, 176, 0, 0.5); }
        body.mode-exec { --primary: #C084FC; --primary-glow: rgba(192, 132, 252, 0.5); }

        /* --- BASE PHYSICS --- */
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
        html { scroll-behavior: smooth; }

        body {
            background-color: var(--void);
            color: #fff;
            font-family: var(--font-body);
            overflow-x: hidden;
            min-height: 100vh;
            /* The Moving Nebula Background */
            background-image:
                radial-gradient(circle at 50% 50%, rgba(0, 255, 65, 0.03) 0%, transparent 50%),
                linear-gradient(0deg, rgba(0,0,0,0.2) 0%, transparent 1px);
            background-size: 100vw 100vh, 100% 4px;
        }

        /* --- ADVANCED ANIMATIONS --- */
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        @keyframes scan { 0% { background-position: 0% 0%; } 100% { background-position: 0% 100%; } }
        @keyframes pulse-glow { 0% { box-shadow: 0 0 0 0 var(--primary-glow); } 70% { box-shadow: 0 0 20px 10px transparent; } 100% { box-shadow: 0 0 0 0 transparent; } }
        @keyframes glitch-text {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 1px); }
            40% { transform: translate(-1px, -1px); }
            60% { transform: translate(2px, 0px); }
            80% { transform: translate(1px, 2px); }
            100% { transform: translate(0); }
        }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        /* --- FX LAYERS --- */
        .scanlines {
            position: fixed; inset: 0; z-index: 9998; pointer-events: none;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px;
            opacity: 0.3;
        }

        .bg-grid {
            position: fixed; inset: 0; z-index: -1;
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            perspective: 500px;
            transform: scale(1.2);
            mask-image: radial-gradient(circle at center, black 40%, transparent 80%);
        }

        /* --- NAV: FROSTED GLASS --- */
        header {
            position: fixed; top: 0; width: 100%; z-index: 1000;
            background: rgba(3, 3, 4, 0.7);
            backdrop-filter: blur(20px) saturate(180%);
            border-bottom: 1px solid var(--glass-border);
            padding: 20px 0;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 30px; }
        .nav-flex { display: flex; justify-content: space-between; align-items: center; }

        .logo {
            font-family: var(--font-display);
            font-weight: 700;
            letter-spacing: 2px;
            color: #fff;
            text-shadow: 0 0 20px var(--primary-glow);
        }

        .social-link, .audio-btn {
            font-family: var(--font-tech);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
            color: rgba(255,255,255,0.6);
            text-decoration: none;
            margin-left: 25px;
            transition: color 0.3s;
        }
        .social-link:hover, .audio-btn:hover { color: var(--primary); text-shadow: 0 0 10px var(--primary); }
        .audio-btn { background: none; border: 1px solid var(--glass-border); padding: 5px 12px; cursor: pointer; }

        /* --- HERO: CINEMATIC TYPE --- */
        .hero {
            min-height: 90vh;
            display: flex; flex-direction: column; justify-content: center;
            position: relative;
            padding-top: 120px;
        }

        .badge {
            font-family: var(--font-tech);
            font-weight: 700;
            letter-spacing: 2px;
            padding: 8px 16px;
            background: rgba(0, 255, 65, 0.05);
            border: 1px solid var(--primary);
            color: var(--primary);
            display: inline-block;
            margin-bottom: 40px;
            box-shadow: 0 0 30px var(--primary-glow);
        }

        h1 {
            font-family: var(--font-display);
            font-size: clamp(2.5rem, 6vw, 5rem);
            line-height: 1.1;
            text-transform: uppercase;
            margin-bottom: 30px;
            background: linear-gradient(to right, #fff, #aaa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 30px rgba(255,255,255,0.1));
            cursor: default;
            min-height: 2.2em;
        }

        .typing-cursor::after { content: '_'; animation: blink 0.8s infinite; color: var(--primary); }

        .hero-sub {
            font-family: var(--font-body);
            font-size: 1.2rem;
            font-weight: 300;
            color: rgba(255,255,255,0.7);
            max-width: 600px;
            margin-bottom: 50px;
            border-left: 2px solid var(--primary);
            padding-left: 20px;
        }

        /* --- BUTTONS: MAGNETIC GLOW --- */
        .btn {
            background: var(--primary);
            color: #000;
            font-family: var(--font-display);
            font-weight: 700;
            letter-spacing: 1px;
            padding: 18px 40px;
            border: none;
            position: relative;
            overflow: hidden;
            transition: all 0.4s var(--ease-out);
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 0 50px var(--primary-glow);
        }

        .dynamic-price {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: rgba(255,255,255,0.5);
            margin-left: 30px;
            border-bottom: 1px solid var(--glass-border);
            padding-bottom: 5px;
        }

        /* --- GRID SYSTEMS --- */
        .grid-header {
            font-family: var(--font-tech);
            font-size: 0.9rem;
            letter-spacing: 4px;
            color: var(--primary);
            margin-top: 120px;
            margin-bottom: 40px;
            border-bottom: 1px solid var(--primary);
            padding-bottom: 10px;
            text-transform: uppercase;
            opacity: 0.8;
        }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; margin-bottom: 80px; }
        .capability-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; }
        .matrix-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; margin-top: 40px; }

        /* --- HOLOGRAPHIC CARDS (The Magic) --- */
        .card-holo {
            background: rgba(10, 10, 12, 0.4);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            padding: 40px;
            min-height: 450px;
            position: relative;
            overflow: hidden;
            transition: all 0.5s var(--ease-out);
            border-radius: 4px;
        }

        /* The Image Layer */
        .card-holo::before {
            content: ''; position: absolute; inset: 0;
            background-size: cover; background-position: center;
            opacity: 0.4;
            mix-blend-mode: luminosity;
            transition: all 0.6s ease;
            filter: grayscale(100%) contrast(1.2);
            z-index: 0;
        }

        /* The Scanline Overlay */
        .card-holo::after {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.8) 50%);
            background-size: 100% 4px;
            opacity: 0.2;
            pointer-events: none;
            z-index: 1;
        }

        /* Card Hover Physics */
        .card-holo:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: var(--primary);
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.8), 0 0 30px var(--primary-glow);
        }

        .card-holo:hover::before {
            opacity: 0.6;
            filter: grayscale(0%) contrast(1.1);
            transform: scale(1.1);
        }

        /* Card Content Styling */
        .card-content { position: relative; z-index: 3; height: 100%; display: flex; flex-direction: column; }
        .card-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }

        .card-label {
            font-family: var(--font-tech);
            font-weight: 700;
            color: #000;
            background: var(--primary);
            padding: 4px 8px;
            font-size: 0.75rem;
            letter-spacing: 1px;
        }

        .card-live {
            font-family: var(--font-tech);
            color: var(--primary);
            text-shadow: 0 0 10px var(--primary);
            letter-spacing: 1px;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .blink-dot {
            width: 6px;
            height: 6px;
            background: var(--primary);
            border-radius: 50%;
            animation: blink 2s infinite;
        }

        .card-holo h3 {
            font-family: var(--font-display);
            font-size: 1.8rem;
            margin: 20px 0 10px 0;
            text-transform: uppercase;
            letter-spacing: -1px;
        }

        .card-holo p {
            font-size: 1rem;
            color: rgba(255,255,255,0.7);
            line-height: 1.6;
            margin-bottom: 30px;
            font-weight: 300;
        }

        .live-metric {
            font-family: var(--font-tech);
            font-size: 0.65rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .card-actions {
            margin-top: auto;
            display: flex;
            gap: 10px;
        }

        /* --- SPECIFIC IMAGE MAPPINGS (Update these with your AI Art) --- */
        .card-skyguard::before { background-image: url('skyguard-ui.jpg'); }
        .card-veteran::before { background-image: url('veteran-ui.jpg'); }
        .card-secureflow::before { background-image: url('secureflow-ui.jpg'); }
        .card-grant::before { background-image: url('grant-ui.jpg'); }

        /* Veteran Card Special Logic (Invert for Dark Mode) */
        .card-veteran::before { filter: grayscale(100%) invert(90%) contrast(1.2); }
        .card-veteran:hover::before { filter: grayscale(0%) invert(0%); }

        /* --- MICRO-INTERACTIONS (Buttons inside cards) --- */
        .btn-sm {
            flex: 1;
            padding: 15px;
            font-family: var(--font-tech);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.8rem;
            text-decoration: none;
            display: flex; justify-content: center; align-items: center;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
        }

        .btn-fill {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            backdrop-filter: blur(5px);
        }
        .btn-fill:hover {
            background: var(--primary);
            color: #000;
            border-color: var(--primary);
            box-shadow: 0 0 20px var(--primary-glow);
        }

        .btn-outline {
            border: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.6);
            background: transparent;
        }
        .btn-outline:hover {
            border-color: #fff;
            color: #fff;
        }

        /* --- CAPABILITY CARDS --- */
        .cap-card {
            background: rgba(255,255,255,0.02);
            border: 1px solid var(--glass-border);
            padding: 30px;
        }
        .cap-icon {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 15px;
            font-family: var(--font-tech);
        }
        .cap-head {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #fff;
        }
        .cap-body {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
            line-height: 1.7;
        }
        .cap-list {
            margin-top: 20px;
            padding-left: 0;
            list-style: none;
        }
        .cap-list li {
            font-family: var(--font-tech);
            font-size: 0.75rem;
            color: rgba(255,255,255,0.6);
            margin-bottom: 8px;
            padding-left: 15px;
            border-left: 1px solid var(--primary);
        }

        /* --- MATRIX CARDS (Glass Panels) --- */
        .matrix-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
            border: 1px solid var(--glass-border);
            padding: 35px;
            backdrop-filter: blur(10px);
            transition: 0.4s;
        }
        .matrix-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .matrix-title {
            font-family: var(--font-display);
            font-size: 1.1rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 20px;
        }
        .matrix-body {
            font-size: 0.9rem;
            color: #aaa;
            line-height: 1.7;
            margin-bottom: 20px;
            min-height: 80px;
        }
        .matrix-verdict {
            font-family: var(--font-tech);
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: 1px;
            border-top: 1px solid var(--glass-border);
            padding-top: 15px;
            margin-top: 20px;
        }

        /* --- CALENDAR HUD --- */
        .cal-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-family: var(--font-tech);
            font-size: 0.8rem;
        }
        .cal-btn {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: rgba(255,255,255,0.6);
            padding: 5px 10px;
            cursor: pointer;
            font-family: var(--font-tech);
        }
        .cal-btn:hover {
            color: var(--primary);
            border-color: var(--primary);
        }

        .cal-grid {
            display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px;
            background: rgba(0,0,0,0.5); padding: 10px; border: 1px solid var(--glass-border);
        }

        .cal-day {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.05);
            min-height: 90px;
            padding: 10px;
            display: flex; flex-direction: column; justify-content: space-between;
            font-family: var(--font-tech);
            transition: all 0.2s;
            cursor: pointer;
        }

        .cal-day:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--primary);
            transform: scale(1.1);
            z-index: 10;
            box-shadow: 0 0 20px var(--primary-glow);
        }

        .cal-day.booked {
            background: #000;
            opacity: 0.3;
            border-style: dashed;
            cursor: not-allowed;
        }
        .cal-day.booked:hover {
            transform: none;
            box-shadow: none;
        }

        .cal-day.surge {
            border-color: var(--alert);
            color: var(--alert);
            background: rgba(255,0,0,0.05);
        }

        .cal-price {
            font-weight: 700;
            font-size: 1rem;
            letter-spacing: 1px;
        }

        /* --- LOSS TICKER --- */
        .loss-ticker {
            background: radial-gradient(circle, rgba(255,0,0,0.05) 0%, transparent 70%);
            border: 1px solid rgba(255,0,0,0.2);
            text-align: center;
            padding: 60px 20px;
            margin: 80px 0;
            position: relative;
        }
        .loss-ticker::before {
            content: 'WARNING // FINANCIAL BLEED';
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-family: var(--font-tech);
            font-size: 0.7rem;
            letter-spacing: 3px;
            color: var(--alert);
            opacity: 0.7;
        }

        .loss-val {
            font-family: var(--font-tech);
            font-size: 5rem;
            font-weight: 700;
            color: var(--alert);
            text-shadow: 0 0 30px var(--alert-glow);
            letter-spacing: -2px;
        }

        /* --- HUD OVERLAYS --- */
        .telemetry-node {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9000;
            font-family: var(--font-tech);
            font-size: 0.65rem;
            color: rgba(255,255,255,0.4);
            pointer-events: none;
            text-align: right;
            mix-blend-mode: exclusion;
        }

        .active-users {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 8000;
            font-family: var(--font-tech);
            font-size: 0.7rem;
            color: var(--primary);
            background: rgba(0,0,0,0.8);
            padding: 5px 10px;
            border: 1px solid var(--primary);
            box-shadow: 0 0 15px var(--primary-glow);
            letter-spacing: 1px;
        }

        .agent-log {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 8000;
            font-family: var(--font-tech);
            font-size: 0.7rem;
            color: var(--primary);
            opacity: 0.7;
        }

        /* --- MODALS --- */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .hidden { display: none !important; }

        .term-modal {
            width: 90%;
            max-width: 600px;
            background: rgba(5, 5, 5, 0.95);
            border: 1px solid var(--primary);
            backdrop-filter: blur(20px);
            box-shadow: 0 0 100px rgba(0,255,65,0.1);
        }
        .term-header {
            font-family: var(--font-display);
            letter-spacing: 2px;
            background: var(--primary);
            color: #000;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
        }
        .term-body {
            padding: 20px;
        }
        .term-input {
            background: rgba(255,255,255,0.05);
            border: none;
            border-bottom: 2px solid #333;
            color: #fff;
            font-family: var(--font-display);
            padding: 15px;
            margin-bottom: 20px;
            transition: 0.3s;
            width: 100%;
        }
        .term-input:focus {
            border-bottom-color: var(--primary);
            background: rgba(0,255,65,0.05);
        }

        /* --- MOBILE ADJUSTMENTS --- */
        @media (max-width: 768px) {
            body { padding-bottom: 60px; }
            h1 { font-size: 2.5rem; }
            .hero { min-height: 70vh; padding-top: 100px; }
            .container { padding: 0 16px; }
            .card-holo { min-height: auto; padding: 20px; }
            .loss-val { font-size: 3rem; }
            .grid { grid-template-columns: 1fr; gap: 20px; }
            .capability-grid { grid-template-columns: 1fr; gap: 20px; }
            .matrix-grid { grid-template-columns: 1fr; gap: 15px; }
            .cal-grid { grid-template-columns: repeat(4, 1fr); gap: 6px; }
            .cal-day { min-height: 80px; padding: 6px; font-size: 0.65rem; }
            .scanlines { opacity: 0.2; }
        }

        @media (max-width: 480px) {
            h1 { font-size: 2rem; }
            .cal-grid { grid-template-columns: repeat(3, 1fr); }
        }

        /* --- WEAPONIZED TEXT FX --- */

        /* The "Data-Stream" Highlight */
        .tactical-highlight {
            position: relative;
            display: inline-block;
            color: #fff;
        }
        .tactical-highlight::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0%; /* Animates to 100% */
            height: 100%;
            background: var(--primary-glow);
            z-index: -1;
            transform: skewX(-15deg);
            transition: width 0.5s cubic-bezier(0.22, 1, 0.36, 1);
        }
        .tactical-highlight.locked::after {
            width: 105%;
        }

        /* The Decryption Cursor */
        .decrypt-char {
            display: inline-block;
            font-family: var(--font-tech);
            color: var(--primary);
        }

        /* Crisis Mode Jitter (Psychological Stress) */
        body.mode-crisis h1, body.mode-crisis .loss-val {
            animation: nervous 0.15s infinite;
        }
        @keyframes nervous {
            0% { transform: translate(0,0); }
            25% { transform: translate(1px, 1px); }
            50% { transform: translate(0,0); }
            75% { transform: translate(-1px, -1px); }
            100% { transform: translate(0,0); }
        }

        /* Reveal Mask for Paragraphs */
        .reveal-text {
            clip-path: polygon(0 0, 100% 0, 100% 100%, 0% 100%);
        }

        /* --- CLASSIFIED REDACTION SYSTEM --- */
        .redacted {
            background: #000;
            color: transparent;
            position: relative;
            display: inline-block;
            padding: 2px 4px;
            transition: all 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        }
        .redacted::before {
            content: '███';
            position: absolute;
            left: 0;
            top: 0;
            color: rgba(255,255,255,0.1);
            letter-spacing: -2px;
            transition: all 0.4s ease;
        }
        .redacted.revealed {
            background: transparent;
            color: var(--primary);
            font-weight: bold;
        }
        .redacted.revealed::before {
            content: '';
            opacity: 0;
        }

        /* Active Declassification Animation */
        @keyframes declassify-sweep {
            0% {
                clip-path: inset(0 0 0 0);
            }
            100% {
                clip-path: inset(0 100% 0 0);
            }
        }
        .redacted.revealing::before {
            animation: declassify-sweep 0.5s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }

        /* Re-classification (when scrolling back up) */
        .redacted.reclassifying {
            animation: reclassify 0.5s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }
        @keyframes reclassify {
            0% {
                background: transparent;
                color: var(--primary);
            }
            100% {
                background: #000;
                color: transparent;
            }
        }

        /* Yellow Highlighter Effect */
        .classified-highlight {
            background: linear-gradient(104deg, transparent 0%, transparent 50%, rgba(255,176,0,0.4) 50%, rgba(255,176,0,0.4) 100%);
            background-size: 200% 100%;
            background-position: 100% 0;
            transition: background-position 0.8s ease;
            padding: 2px 4px;
            margin: 0 2px;
        }
        .classified-highlight.marked {
            background-position: 0% 0;
        }

        /* Black Marker Censorship */
        .censored {
            background: transparent;
            color: inherit;
            padding: 2px 6px;
            display: inline-block;
            position: relative;
            transition: all 0.5s ease;
        }
        .censored::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, #000 0%, #1a1a1a 50%, #000 100%);
            opacity: 0;
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.3s ease;
            z-index: 1;
        }
        .censored.classified::after {
            opacity: 1;
            transform: scaleX(1);
        }
        .censored.classified {
            color: transparent;
        }
        .censored.declassified::after {
            opacity: 0;
            transform: scaleX(0);
            transform-origin: right;
        }
        .censored.declassified {
            background: transparent;
            color: var(--primary);
        }

        /* Active Blackout Animation (typing blackout effect) */
        @keyframes blackout-sweep {
            0% {
                transform: scaleX(0);
                opacity: 0;
            }
            20% {
                opacity: 1;
            }
            100% {
                transform: scaleX(1);
                opacity: 1;
            }
        }
        .censored.active-blackout::after {
            animation: blackout-sweep 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }

        /* Keyword Pulse (motivating words) */
        .keyword-pulse {
            animation: keyword-glow 2s ease-in-out infinite;
        }
        @keyframes keyword-glow {
            0%, 100% {
                text-shadow: 0 0 5px var(--primary-glow);
                color: var(--primary);
            }
            50% {
                text-shadow: 0 0 20px var(--primary-glow), 0 0 30px var(--primary-glow);
                color: #fff;
            }
        }
    </style>
</head>
<body>

    <div id="contact-modal" class="overlay hidden">
        <div class="term-modal">
            <div class="term-header"><span>>> SECURE UPLINK</span><span style="cursor: pointer;" onclick="Comms.close()">[X]</span></div>
            <div class="term-body">
                <div class="term-label">IDENTITY</div>
                <input type="text" id="contact-name" class="term-input" placeholder="Enter identification...">
                <div class="term-label">MISSION</div>
                <input type="text" id="contact-mission" class="term-input" placeholder="Objective...">
                <div class="term-label">ALLOCATION</div>
                <select id="contact-budget" class="term-input" style="background:#000;"><option value="tier1">Sprint ($7.5k)</option><option value="tier2">Architecture ($28k)</option></select>
                <button class="btn" style="width: 100%; margin-top: 20px;" onclick="Comms.transmit()">TRANSMIT SIGNAL</button>
            </div>
        </div>
    </div>

    <div id="lead-modal" class="overlay hidden">
        <div class="term-modal">
            <div class="term-header"><span>>> CREDENTIALS REQUIRED</span><span onclick="document.getElementById('lead-modal').classList.add('hidden')">[X]</span></div>
            <div class="term-body">
                <p>Enter your email to access the secured terminal.</p>
                <input type="email" id="lead-email" class="term-input" placeholder="you@company.com">
                <button class="btn" onclick="LeadCapture.submit()" style="width:100%;">AUTHENTICATE</button>
            </div>
        </div>
    </div>

    <div id="exit-modal" class="overlay hidden">
        <div class="term-modal">
            <div class="term-header"><span>>> MISSION CRITICAL</span><span onclick="document.getElementById('exit-modal').classList.add('hidden')">[X]</span></div>
            <div class="term-body" style="text-align: center;">
                <h3 id="exit-title">Wait. Get the Architecture Brief.</h3>
                <p id="exit-body" style="color: var(--text-muted);">Don't leave empty handed. Download the stack breakdown.</p>
                <a id="exit-cta" href="mailto:mani@aimeintelligence.com?subject=Request%20Architecture%20PDF" class="btn" style="width: 100%;">REQUEST INTEL</a>
            </div>
        </div>
    </div>

    <div class="scanlines"></div>
    <div class="bg-grid"></div>
    <div class="telemetry-node">
        <div>STATUS: <span style="color:var(--primary)">ONLINE</span></div>
        <div>TARGET: <span id="persona-label">ANALYZING...</span></div>
        <div>LOSS: $<span id="daily-loss">0</span></div>
    </div>
    <div class="active-users"><span class="blink-dot"></span> <span id="active-count">12</span> ACTIVE PROSPECTS</div>
    <div id="agent-log" class="agent-log">/// INITIALIZING AGENT...</div>

    <header>
        <div class="container nav-flex">
            <div class="logo">AIME // INTEL</div>
            <div class="mono" style="font-size: 0.7rem; display: flex; align-items: center;">
                <a href="https://github.com/aimeai" target="_blank" class="social-link">GITHUB</a>
                <a href="https://www.linkedin.com/in/manimehramooz" target="_blank" class="social-link">LINKEDIN</a>
                <button id="audio-toggle" class="audio-btn" onclick="AudioController.toggle()">AUDIO: ON</button>
                <span style="margin-left: 15px; color: var(--primary);">SECURE</span>
            </div>
        </div>
    </header>

    <main>
        <section class="container hero">
            <div class="badge" id="hero-badge">OPERATIONAL READINESS</div>
            <h1 class="dynamic-hero">Your Internal Teams<br>Are Too Slow.<br>I Ship in 48 Hours.</h1>
            <p class="hero-sub dynamic-subhero">No agencies. No discovery phases. Just deployment.</p>
            <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
                <button class="btn" id="primary-cta" onclick="document.getElementById('build-buy-header').scrollIntoView({behavior:'smooth'})">INITIATE DEPLOYMENT</button>
                <div class="dynamic-price" style="font-family: var(--mono-font); font-size: 1.2rem; color: var(--text-muted);">$7,500 START</div>
            </div>
        </section>

        <div id="injected-content"></div>
        
        <section class="container" id="doctrine-section" style="margin-top: 80px;">
            <div class="grid-header" id="doctrine-header">/// AIME CAPABILITY DOCTRINE</div>
            <div style="margin-bottom: 40px; max-width: 800px;">
                <h2 id="doctrine-title" style="font-size: 2rem; margin-bottom: 15px;">I am not a freelancer.<br>I am a Pre-Built Autonomous Unit.</h2>
                <p id="doctrine-sub" style="color: var(--text-muted);">Agencies sell you "Discovery Phases" because they don't know how to build your system yet. I do. I have spent 10,000 hours building the operational infrastructure you needed yesterday.</p>
            </div>
            
            <div class="capability-grid" id="capability-grid">
                </div>
        </section>

        <section class="container" id="loss-section">
            <div class="loss-ticker">
                <div class="mono" id="loss-label" style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 10px;">/// OPPORTUNITY COST ANALYSIS</div>
                <h3 id="loss-headline" style="color: var(--alert); transition: opacity 0.3s;">Every Day You Wait Costs:</h3>
                <div class="loss-val">$<span id="ticker-val">0</span></div>
                <p id="loss-context" class="mono" style="font-size: 0.85rem; color: var(--text-muted); margin-top: 15px; min-height: 60px; max-width: 800px; margin-left: auto; margin-right: auto; line-height: 1.6; transition: opacity 0.3s;">Based on real-time competitor velocity.</p>
            </div>
        </section>

        <section class="container">
            <div class="grid-header">/// ACTIVE INTELLIGENCE FEEDS</div>
            <div class="grid">
                <div class="card-holo card-skyguard" data-semantic="DEFENSE">
                    <div class="card-content">
                        <div class="card-top"><span class="card-label">LIVE FEED</span><span class="card-live"><div class="blink-dot"></div> ONLINE</span></div>
                        <h3>SkyGuard Tactical</h3>
                        <p>Acoustic drone detection. 15ms Latency Edge-Native architecture.</p>
                        <div class="live-metric">>> THREATS BLOCKED: <span id="metric-skyguard">14,201</span></div>
                        <div class="card-actions">
                            <button onclick="LeadCapture.request('SkyGuard', 'https://skyguard-tactical-nt0sfkp59-aimeintelligence-gmailcoms-projects.vercel.app')" class="btn-sm btn-fill">LAUNCH TERMINAL ↗</button>
                            <button class="btn-sm btn-outline" onclick="SalesEngine.trackIntent('DEFENSE', 'skyguard-intel.html')">INTEL DOSSIER</button>
                        </div>
                    </div>
                </div>
                <div class="card-holo card-veteran" data-semantic="LOGISTICS">
                    <div class="card-content">
                        <div class="card-top">
                            <span class="card-label">LOGISTICS</span>
                            <span class="card-live"><div class="blink-dot"></div> 237 NODES</span>
                        </div>
                        <div style="position: absolute; top: 10px; right: 10px; background: rgba(0,255,65,0.2); border: 1px solid var(--primary); padding: 2px 8px; font-family: var(--mono-font); font-size: 0.55rem; color: var(--primary); font-weight: bold; z-index: 10;">
                            [ DEPLOYED: WOUNDED WARRIORS CANADA ]
                        </div>
                        <h3>Vet_Link Ops</h3>
                        <p>Secure Human Capital Network. NIST 800-53 Compliant.</p>
                        <div class="live-metric">>> ACTIVE BIDS: <span id="metric-vet">412</span></div>
                        <div class="card-actions">
                            <button onclick="LeadCapture.request('VetLink', 'https://veteran-job-portal-fpl7r84ib.vercel.app')" class="btn-sm btn-fill">LAUNCH PORTAL ↗</button>
                            <button class="btn-sm btn-outline" onclick="SalesEngine.trackIntent('LOGISTICS', 'veteran-intel.html')">INTEL DOSSIER</button>
                        </div>
                    </div>
                </div>
                <div class="card-holo card-secureflow" data-semantic="CYBER">
                    <div class="card-content">
                        <div class="card-top"><span class="card-label">CYBERSEC</span><span class="card-live"><div class="blink-dot"></div> MONITORING</span></div>
                        <h3>SecureFlow</h3>
                        <p>Naval IT Anomaly Detection. Automated Compliance.</p>
                        <div class="live-metric">>> PACKETS SCANNED: <span id="metric-flow">89.4M</span></div>
                        <div class="card-actions">
                            <button onclick="LeadCapture.request('SecureFlow', 'https://operation-secureflow.onrender.com')" class="btn-sm btn-fill">LAUNCH SYSTEM ↗</button>
                            <button class="btn-sm btn-outline" onclick="SalesEngine.trackIntent('CYBER', 'secureflow-case-study.html')">INTEL DOSSIER</button>
                        </div>
                    </div>
                </div>
                <div class="card-holo card-grant" data-semantic="FINANCE">
                    <div class="card-content">
                        <div class="card-top"><span class="card-label">FUNDING</span><span class="card-live"><div class="blink-dot"></div> 62 SOURCES</span></div>
                        <h3>Grant_Recon</h3>
                        <p>Automated Capital Acquisition. Zero-Dependency Architecture.</p>
                        <div class="live-metric">>> CAPITAL TRACKED: $12.5M</div>
                        <div class="card-actions">
                            <button onclick="LeadCapture.request('GrantRecon', 'https://wwbd-fexfjhz0l-aimeintelligence-gmailcoms-projects.vercel.app')" class="btn-sm btn-fill">START RECON ↗</button>
                            <button class="btn-sm btn-outline" onclick="SalesEngine.trackIntent('FINANCE', 'grant-intel.html')">INTEL DOSSIER</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="container" style="margin-top: 80px;">
            <div class="grid-header" id="build-buy-header">/// THE $2M QUESTION</div>
            <div class="matrix-grid" id="matrix-container">
                </div>
        </section>

        <section class="container" style="margin-top: 80px;">
            <div class="grid-header">/// THE 49TH HOUR PROTOCOL™</div>
            <div style="background: rgba(255,255,255,0.02); border: 1px solid var(--primary); padding: 40px;">
                <h2 style="font-size: 2rem; margin-bottom: 20px;">Risk Level: Zero.</h2>
                <p class="hero-sub" id="protocol-text" style="font-size: 1rem;">If your prototype is not demonstrably functional by Hour 49:</p>
                <ul style="list-style: none; padding: 0; font-family: var(--mono-font); font-size: 0.9rem; line-height: 2; color: var(--text-muted);">
                    <li>[1] You receive a <strong>100% Refund</strong> immediately.</li>
                    <li>[2] You retain all <strong>IP & Source Code</strong> generated.</li>
                    <li style="color: var(--primary);">[3] I personally donate <strong>$500</strong> to a Veteran charity.</li>
                </ul>

                <!-- BUTTON INSERTED HERE -->
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px dashed rgba(255,255,255,0.1);">
                    <a href="parameters.html" class="btn-sm btn-outline" style="display: inline-block; width: auto; padding: 10px 20px;">
                        VIEW ENGAGEMENT PARAMETERS >>
                    </a>
                </div>
            </div>
        </section>

        <section class="container" style="padding: 80px 0;">
            <div class="grid-header">/// OPERATIONAL CAPACITY</div>
            <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 30px;">
                <div>
                    <h2 id="cal-header">Secure Your Window</h2>
                    <p class="mono text-muted" id="pricing-context">Dynamic pricing based on load.</p>
                </div>
                <div style="text-align: right;">
                    <div class="dynamic-price" style="font-size: 2.5rem; font-weight: bold; color: var(--primary);">$7,500</div>
                    <div class="mono text-muted">BASE ENGAGEMENT</div>
                </div>
            </div>
            <div style="border: 1px solid var(--border); padding: 20px; background: var(--surface);">
                <div class="cal-nav">
                    <button class="cal-btn" onclick="Calendar.shift(-28)">&lt; PREV</button>
                    <span id="cal-range">LOADING...</span>
                    <button class="cal-btn" onclick="Calendar.shift(28)">NEXT &gt;</button>
                </div>
                <div class="cal-grid" id="cal-grid"></div>
            </div>
        </section>

        <section class="container" style="margin-top: 80px;">
            <div class="grid-header">/// POST-DEPLOYMENT INSURANCE</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
                <div style="border: 1px solid var(--text-muted); padding: 30px; opacity: 0.7;">
                    <h3>Self-Managed</h3>
                    <div style="font-size: 2rem; font-weight: bold; margin: 20px 0;">$0/mo</div>
                    <ul style="list-style: none; padding: 0; font-size: 0.85rem; color: var(--text-muted);">
                        <li>❌ You handle crashes at 3am</li>
                        <li>❌ You scale infrastructure</li>
                        <li>❌ No compliance reports</li>
                    </ul>
                </div>
                <div style="border: 2px solid var(--primary); padding: 30px; background: rgba(0,255,65,0.05);">
                    <div style="background: var(--primary); color: #000; padding: 2px 10px; font-size: 0.7rem; display: inline-block; font-weight: bold; margin-bottom: 10px;">RECOMMENDED</div>
                    <h3 style="color: var(--primary);">Operational Insurance</h3>
                    <div style="font-size: 2rem; font-weight: bold; margin: 20px 0; color: var(--primary);">$2,500/mo</div>
                    <ul style="list-style: none; padding: 0; font-size: 0.85rem; color: var(--text-main);">
                        <li>✅ 15-min emergency response</li>
                        <li>✅ Auto-scaling included</li>
                        <li>✅ Compliance reports</li>
                    </ul>
                    <button class="btn" style="width: 100%; margin-top: 20px;" onclick="Comms.open()">SECURE YOUR SYSTEM</button>
                </div>
            </div>
        </section>

    </main>

    <script>
        'use strict';

        // 1. INTELLIGENCE CORE (The Brain) - v21.2
        const State = {
            dossier: (() => {
                try {
                    const stored = localStorage.getItem('aime_dossier');
                    if (stored) {
                        const data = JSON.parse(stored);
                        // Add timestamp if it doesn't exist
                        if (!data.lastActive) {
                            data.lastActive = Date.now();
                        }
                        return data;
                    }
                    return {
                        scores: { DEFENSE: 0, LOGISTICS: 0, FINANCE: 0, CYBER: 0 },
                        behaviors: { erratic: 0, stress: 0 },
                        persona: 'COMMANDER',
                        lastActive: Date.now()
                    };
                } catch(e) {
                    console.warn('LocalStorage unavailable, using session-only tracking');
                    return {
                        scores: { DEFENSE: 0, LOGISTICS: 0, FINANCE: 0, CYBER: 0 },
                        behaviors: { erratic: 0, stress: 0 },
                        persona: 'COMMANDER',
                        lastActive: Date.now()
                    };
                }
            })(),

            activeUsers: 12,

            applyTimeDecay: function() {
                const now = Date.now();
                const lastActive = this.dossier.lastActive || now;
                const minutesElapsed = (now - lastActive) / 1000 / 60;

                // IMPORTANT: Only apply decay if enough time has actually passed
                // This prevents immediate re-triggering when page just loaded
                if (minutesElapsed < 0.1) {
                    // Less than 6 seconds - they just loaded the page, no decay needed
                    return;
                }

                // If more than 10 minutes have passed, complete reset
                if (minutesElapsed >= 10) {
                    this.dossier.behaviors.erratic = 0;
                    this.dossier.behaviors.stress = 0;
                    this.dossier.persona = 'COMMANDER';
                    this.dossier.scores = { DEFENSE: 0, LOGISTICS: 0, FINANCE: 0, CYBER: 0 };
                    this.log("/// TIME DECAY: COMPLETE RESET TO NEUTRAL");
                } else if (minutesElapsed >= 5) {
                    // Partial decay between 5-10 minutes
                    const decayFactor = (minutesElapsed - 5) / 5; // 0 to 1
                    this.dossier.behaviors.erratic = Math.floor(this.dossier.behaviors.erratic * (1 - decayFactor));
                    this.dossier.behaviors.stress = Math.floor(this.dossier.behaviors.stress * (1 - decayFactor));

                    // If erratic is now low enough, downgrade persona
                    if (this.dossier.behaviors.erratic < 10) {
                        this.dossier.persona = 'COMMANDER';
                    }

                    this.log("/// TIME DECAY: BEHAVIORS COOLING DOWN");
                } else if (minutesElapsed >= 2) {
                    // Light decay after 2 minutes
                    this.dossier.behaviors.erratic = Math.max(0, this.dossier.behaviors.erratic - 5);
                    this.log("/// TIME DECAY: MINOR COOLDOWN");
                }

                // Update timestamp
                this.dossier.lastActive = now;
                this.save();
            },

            save: function() {
                try {
                    this.dossier.lastActive = Date.now();
                    localStorage.setItem('aime_dossier', JSON.stringify(this.dossier));
                } catch(e) {
                    // Silent fail if localStorage is blocked
                }
            },

            ingest: function(signal, category) {
                const weight = (signal === 'click' || signal === 'tap') ? 10 : 2;

                // Update activity timestamp on ANY interaction
                this.dossier.lastActive = Date.now();

                if (category && this.dossier.scores[category] !== undefined) {
                    this.dossier.scores[category] += weight;
                    // *** REDEMPTION LOGIC ***
                    // If they are engaging with content, they aren't frantic.
                    if (this.dossier.behaviors.erratic > 0) {
                        this.dossier.behaviors.erratic -= 1;
                        this.log("/// BEHAVIOR NORMALIZED: FOCUS DETECTED");
                    }
                }

                if (signal === 'rapid_scroll' || signal === 'shake') {
                    // Smaller increment - need multiple instances to trigger crisis
                    this.dossier.behaviors.erratic += 3;
                    this.log("⚠️ BEHAVIORAL ANOMALY DETECTED");
                }

                this.computePersona();
                this.save();
                this.sync();
            },

            computePersona: function() {
                const scores = this.dossier.scores;
                const topVertical = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);

                // Switch if STRONG interest (raised from 5 to 30 - requires deliberate exploration)
                if (scores[topVertical] > 30) {
                    if (topVertical === 'DEFENSE' || topVertical === 'CYBER') this.dossier.persona = 'TECHNICAL_DECISION_MAKER';
                    else this.dossier.persona = 'ENTERPRISE_EXECUTIVE';
                } else {
                    // Default to COMMANDER unless overridden by behavior
                    if (this.dossier.persona !== 'CRISIS_BUYER') {
                        this.dossier.persona = 'COMMANDER';
                    }
                }

                // Sticky Behavior overrides (MUCH higher threshold - need truly extreme behavior)
                if (this.dossier.behaviors.erratic > 50) {
                    this.dossier.persona = 'CRISIS_BUYER';
                } else if (this.dossier.persona === 'CRISIS_BUYER' && this.dossier.behaviors.erratic < 20) {
                    // Recovery Mode: If they calmed down, switch back
                    this.dossier.persona = 'COMMANDER';
                }
            },

            resetToNeutral: function() {
                // Reset erratic behavior to neutral state
                // This is called when user clicks case studies (serious research intent)
                this.dossier.behaviors.erratic = 0;
                this.dossier.behaviors.stress = 0;

                // Keep vertical scores but reset persona to COMMANDER
                this.dossier.persona = 'COMMANDER';

                this.log("/// RESEARCH MODE: RESET TO NEUTRAL");
                this.save();
                this.sync();
            },

            sync: function() {
                Renderer.updateContent(this.dossier.persona, this.vertical);
                Calendar.render();
            },

            get vertical() {
                const s = this.dossier.scores;
                return Object.keys(s).reduce((a, b) => s[a] > s[b] ? a : b);
            },

            forceVertical: function(vertical) {
                // Force switch to a specific vertical by boosting its score
                const verticals = ['DEFENSE', 'LOGISTICS', 'FINANCE', 'CYBER'];

                // Reset all scores
                verticals.forEach(v => this.dossier.scores[v] = 0);

                // Boost the target vertical
                this.dossier.scores[vertical] = 100;

                this.log(`/// SWITCHING TO ${vertical} MODE`);
                this.save();
                this.sync();
            },

            log: function(msg) {
                const el = document.getElementById('agent-log');
                el.innerText = `/// ${msg}`;
                el.style.opacity = 1;
                setTimeout(() => el.style.opacity = 0.7, 2000);
            }
        };

        // 2. SALES ENGINE
        const SalesEngine = {
            trackIntent: function(vertical, url) {
                // Case study/intel dossier click = serious interest = reset to neutral state
                // User is researching, not panicking
                State.resetToNeutral();

                State.ingest('click', vertical);
                AudioController.play('click');
                if(url) setTimeout(() => window.location.href = url, 200);
            }
        };

        // 3. PROFILER (MOBILE & DESKTOP) - INTELLIGENT TRACKING
        const Profiler = {
            bootTime: Date.now(),
            init: function() {
                let lastY = window.scrollY || 0;
                let lastScrollTime = Date.now();
                let dirChanges = 0;
                let lastDir = 0;
                let lastClick = 0;
                let clickCount = 0;
                let hasReachedBottom = false;
                let bottomReachedTime = 0;

                // HOVER (DESKTOP) & TOUCH START (MOBILE INTEREST)
                document.querySelectorAll('[data-semantic]').forEach(el => {
                    el.addEventListener('mouseenter', () => State.ingest('hover', el.getAttribute('data-semantic')));
                    el.addEventListener('touchstart', () => State.ingest('hover', el.getAttribute('data-semantic')), {passive: true});
                    el.addEventListener('click', () => State.ingest('click', el.getAttribute('data-semantic')));
                });

                // INTELLIGENT SCROLL TRACKING - Detects extreme behavior AND full-page read pattern
                window.addEventListener('scroll', () => {
                    const now = Date.now();
                    const secondsSinceBoot = (now - this.bootTime) / 1000;

                    // 3 second grace period to allow normal reading
                    if (secondsSinceBoot < 3) return;

                    const currY = window.scrollY;
                    const diff = currY - lastY;
                    const timeDiff = now - lastScrollTime;

                    // Check if user has reached the bottom of the page
                    const scrollHeight = document.documentElement.scrollHeight;
                    const clientHeight = document.documentElement.clientHeight;
                    const scrolledToBottom = (currY + clientHeight) >= (scrollHeight - 100);

                    if (scrolledToBottom && !hasReachedBottom) {
                        hasReachedBottom = true;
                        bottomReachedTime = now;
                        State.log("/// FULL PAGE READ DETECTED");
                    }

                    // If user reached bottom and now scrolling back to top, force mode shift
                    if (hasReachedBottom && currY < 300) {
                        const timeSinceBottom = (now - bottomReachedTime) / 1000;

                        // If they scrolled back to top within 10 seconds of reaching bottom
                        if (timeSinceBottom < 10) {
                            // Force cycle to next persona
                            const personas = ['COMMANDER', 'TECHNICAL_DECISION_MAKER', 'ENTERPRISE_EXECUTIVE'];
                            const currentIndex = personas.indexOf(State.dossier.persona);
                            const nextIndex = (currentIndex + 1) % personas.length;
                            State.dossier.persona = personas[nextIndex];

                            // Also cycle vertical
                            const verticals = ['DEFENSE', 'LOGISTICS', 'FINANCE', 'CYBER'];
                            const currentVertical = State.vertical;
                            const verticalIndex = verticals.indexOf(currentVertical);
                            const nextVertical = verticals[(verticalIndex + 1) % verticals.length];
                            State.forceVertical(nextVertical);

                            State.log("/// BOTTOM-TO-TOP SCROLL: MODE SHIFT");
                            hasReachedBottom = false; // Reset for next scroll-through
                        }
                    }

                    // Ignore small movements (normal scrolling)
                    if (Math.abs(diff) < 200) {
                        lastY = currY;
                        lastScrollTime = now;
                        return;
                    }

                    // Track direction changes
                    const currDir = diff > 0 ? 1 : -1;

                    // DIRECTION CHANGE DETECTION: Rapid up/down switching
                    // Only count if:
                    // 1. Direction actually changed AND
                    // 2. Movement was VERY significant (>200px) AND
                    // 3. Happened VERY quickly (<400ms since last change)
                    if (currDir !== lastDir && lastDir !== 0 && timeDiff < 400) {
                        dirChanges++;

                        // Requires 8+ RAPID direction changes (very aggressive scrolling)
                        if (dirChanges >= 8) {
                            State.ingest('rapid_scroll', null);
                            dirChanges = 0;
                        }
                    }

                    // Reset counter after 3 seconds of calm
                    if (timeDiff > 3000) {
                        dirChanges = 0;
                    }

                    lastDir = currDir;
                    lastY = currY;
                    lastScrollTime = now;
                });

                // Rage Clicks
                document.addEventListener('click', () => {
                    const now = Date.now();
                    if (now - lastClick < 300) {
                        clickCount++;
                        if(clickCount > 3) State.ingest('shake', null);
                    } else { clickCount = 0; }
                    lastClick = now;
                });
            }
        };

        // 4. CALENDAR (GAME THEORY OPTIMIZED)
        const Calendar = {
            offset: 0,
            
            // Strategy: High Start (Panic) -> Low Middle (The Trap) -> High End (Standard)
            // We want them to book the "Middle" slots ($4.5k - $6.5k)
            
            calculateDynamicPrice: function(dayIndex) {
                const p = State.dossier.persona;
                const v = State.vertical;

                // PRICING STRATEGY:
                // You're not selling hours. You're selling $50k-$120k agency value for $7.5k-$12k.
                // That's a 6.5x ROI for the client. Price to perceived value, not time.

                // 1. BASE CURVE (The U-Shape - Game Theory Optimized)
                let price = 0;

                if (dayIndex < 3) {
                    // EMERGENCY SURGE (Days 0-2): "I need this NOW"
                    // Agencies charge $80k-$120k for 90-day sprints. You deliver in 48 hours.
                    // Price: $11,500 - $12,800 (psychological anchor under $13k)
                    price = 11500 + (Math.random() * 1300);
                } else if (dayIndex >= 3 && dayIndex < 10) {
                    // THE SWEET SPOT (Days 3-10): "The Deal"
                    // This is where you WANT them to book. Strategic pricing.
                    // Floor = $7,500 (never go below this - it's your poverty line)
                    // Ceiling = $9,800 (under $10k psychological barrier for credit card limits)
                    price = 7500 + (Math.random() * 2300);
                } else {
                    // STANDARD FUTURE (Days 11+): "Normal Market Rate"
                    // Competitors charge $50k-$80k for 3-month projects.
                    // You're 10x faster. Price accordingly.
                    // Target: $9,200 - $11,500
                    price = 9200 + (dayIndex * 40) + (Math.random() * 800);
                }

                // 2. VERTICAL VALUE MULTIPLIERS (Defense/Cyber = Premium)
                // Defense contractors are used to $200k-$5M contracts. Your pricing is a rounding error.
                if (v === 'DEFENSE' || v === 'CYBER') {
                    price *= 1.12; // 12% premium for security/compliance overhead
                } else if (v === 'FINANCE') {
                    price *= 1.08; // 8% premium for regulatory complexity
                }

                // 3. PERSONA BEHAVIORAL MULTIPLIERS
                if (p === 'CRISIS_BUYER') {
                    // Panic tax: If they're frantic, they'll pay anything to ship tonight
                    // Traditional agencies would quote $150k+ for "emergency" work
                    price *= 1.25; // 25% crisis premium
                } else if (p === 'ENTERPRISE_EXECUTIVE') {
                    // Executives think in ROI, not price. They'll pay for speed.
                    price *= 1.10; // 10% executive premium
                } else if (p === 'TECHNICAL_DECISION_MAKER') {
                    // Techies appreciate efficiency. Give them a *slight* efficiency discount in the sweet spot.
                    if(dayIndex >= 3 && dayIndex < 10) price *= 0.97; // 3% efficiency discount
                }

                // 4. FLOOR ENFORCEMENT (Never commoditize)
                // $7,500 is the absolute minimum. Below this, you're competing with Upwork.
                if (price < 7500) price = 7500;

                // 5. CEILING CAP (Psychological barriers)
                // $12,950 is the credit card sweet spot (under $13k)
                if (price > 12950) price = 12950;

                // Round to clean numbers that look intentional (e.g., $7,500, $8,200, $9,800)
                return Math.floor(price / 100) * 100;
            },

            render: function() {
                const grid = document.getElementById('cal-grid');
                if(!grid) return;
                grid.innerHTML = '';
                const now = new Date(); now.setHours(0,0,0,0);
                const start = new Date(now); start.setDate(start.getDate() + this.offset);
                const end = new Date(start); end.setDate(start.getDate() + 28);
                document.getElementById('cal-range').innerText = `${start.toLocaleDateString()} - ${end.toLocaleDateString()}`;

                let lowestPriceSeen = 999999;
                const ctxEl = document.getElementById('pricing-context');
                
                // CONTEXT TEXT UPDATES - Value-based messaging
                const v = State.vertical;

                if(State.dossier.persona === 'CRISIS_BUYER') {
                    ctxEl.innerHTML = "⚠️ <span style='color:var(--alert)'>EMERGENCY DEPLOYMENT: +25% SURGE.</span> Traditional agencies quote $150k+ for immediate work. Lock in NOW.";
                    ctxEl.style.color = "var(--alert)";
                } else if(State.dossier.persona === 'ENTERPRISE_EXECUTIVE') {
                    const agencyComparison = v === 'DEFENSE' ? '$120k agency sprint' : v === 'FINANCE' ? '$80k compliance build' : '$50k traditional vendor';
                    ctxEl.innerHTML = `ROI-Optimized Pricing. <span style='color:var(--primary)'>${agencyComparison} → 48-hour delivery for 10x less.</span>`;
                    ctxEl.style.color = "var(--text-muted)";
                } else if(State.dossier.persona === 'TECHNICAL_DECISION_MAKER') {
                    ctxEl.innerHTML = "Efficiency Discount Active. <span style='color:var(--primary)'>Green = Under $10k credit card limit. Book sweet spot slots.</span>";
                    ctxEl.style.color = "var(--text-muted)";
                } else {
                    const valueMsg = v === 'DEFENSE' || v === 'CYBER' ? '+12% security premium' : v === 'FINANCE' ? '+8% compliance premium' : 'base rate';
                    ctxEl.innerHTML = `Value-Based Pricing (${valueMsg}). <span style='color:var(--primary)'>Green slots = $7.5k-$9.8k range.</span>`;
                    ctxEl.style.color = "var(--text-muted)";
                }

                for(let i=0; i<28; i++) {
                    let d = new Date(start); d.setDate(start.getDate() + i);
                    let day = document.createElement('div');
                    let isToday = d.getTime() === now.getTime();
                    let isPast = d < now;
                    
                    // CALCULATE PRICE
                    const price = this.calculateDynamicPrice(i);
                    
                    // Track the "Deal" price (only count available slots)
                    // We fake "Booked" slots to create social proof
                    // Logic: Randomly book 30% of slots to look busy, but keep the "Sweet Spot" mostly open
                    const dateSeed = d.getDate() + d.getMonth() + i; 
                    let isBooked = (dateSeed % 3 === 0); 
                    
                    // Force sweet spot to be open (we want them to buy these)
                    if (i >= 3 && i < 8) isBooked = false;

                    if (!isBooked && !isPast && price < lowestPriceSeen) lowestPriceSeen = price;

                    let status = '';
                    if (this.offset === 0 && i < 3) status = 'surge'; // Visual red border for surge

                    day.className = `cal-day ${isToday?'today':''} ${status}`;
                    
                    if((isPast && !isToday) || isBooked) { 
                        day.classList.add('booked'); 
                        day.innerHTML = `<div>${d.getDate()}</div><div style="margin-top:auto;font-size:0.6rem">${isPast?'GONE':'DEPLOYED'}</div>`; 
                    } else {
                        // VALUE-BASED COLOR CODING
                        // Green = Sweet Spot ($7.5k-$9.8k) - Where we WANT them to book
                        // White = Standard ($9.8k-$11.5k) - Normal market rate
                        // Red = Surge ($11.5k+) - Emergency pricing
                        let priceColor = 'inherit';

                        if (price < 9800) {
                            priceColor = 'var(--primary)'; // GREEN: The "Deal" (under $10k psychological barrier)
                        } else if (price >= 11500) {
                            priceColor = 'var(--alert)'; // RED: Surge pricing
                        }
                        // else: WHITE (standard rate $9.8k-$11.5k)

                        day.innerHTML = `<div>${d.getDate()}</div><div class="cal-price" style="color:${priceColor}">$${(price/1000).toFixed(1)}k</div>`;
                        day.onclick = () => Comms.open(`Slot: ${d.toDateString()}`, price);
                    }
                    grid.appendChild(day);
                }
                
                // UPDATE THE BIG PRICE DISPLAY TO SHOW THE "LOWEST" AVAILABLE ( The Hook )
                document.querySelectorAll('.dynamic-price').forEach(el => {
                    el.innerHTML = `<span>$${lowestPriceSeen.toLocaleString()}</span> <span style="font-size:0.5em; color:var(--text-muted)">OPEN SLOT</span>`;
                });
            },
            shift: function(d) { this.offset+=d; if(this.offset<0) this.offset=0; this.render(); }
        };

        // 5. LOSS TICKER (Economic Future Slideshow)
        const LossTicker = {
            interval: null,
            value: 0,
            slideInterval: null,
            currentSlide: 0,

            slides: {
                'COMMANDER': [
                    { headline: "Every Day You Wait Costs:", context: "Your competitors are automating. While you plan meetings, they're deploying AI systems that cut their operational costs by 40%. The gap widens daily." },
                    { headline: "The Automation Gap Is Widening:", context: "Companies that deployed AI in 2023 now have 18-month leads in operational efficiency. Every week you delay is 3 weeks of catch-up work." },
                    { headline: "Your Opportunity Window Is Closing:", context: "The automated economy rewards early movers. First-mover advantage in AI implementation compounds monthly. Those who wait pay the 'late adopter tax.'" },
                    { headline: "Market Share Erosion in Real-Time:", context: "Automated competitors can undercut your pricing by 30% while maintaining margins. They're winning your customers right now, while you're stuck in procurement." },
                    { headline: "The Cost of Standing Still:", context: "In a market moving at AI velocity, standing still is moving backwards. Every day without automation is a day of lost competitive positioning." },
                    { headline: "Future-Proof or Fall Behind:", context: "The automated economy isn't coming - it's here. Companies that secure their position now will dominate their verticals for the next decade." }
                ],
                'TECHNICAL_DECISION_MAKER': [
                    { headline: "Technical Debt Compounds Daily:", context: "Every day spent on legacy systems is compounding technical debt. Modern edge-native architectures deploy in hours, not quarters." },
                    { headline: "Your Stack Is Aging While You Read This:", context: "Cloud-dependent architectures cost 3x more than edge-native at scale. Latency kills user experience. 15ms response time is table stakes now." },
                    { headline: "The Build vs. Buy Decision Costs You:", context: "Building in-house takes 18 months minimum. By then, your requirements have changed twice. Pre-validated stacks deploy in 48 hours." },
                    { headline: "Infrastructure Velocity = Business Velocity:", context: "Companies with sub-20ms latency see 34% higher conversion rates. Your infrastructure speed directly impacts revenue. Every millisecond costs money." },
                    { headline: "Open Source = Sovereignty:", context: "Vendor lock-in is a recurring tax on your business. Own your repo, own your keys, own your future. MIT licensed code has zero exit costs." },
                    { headline: "Edge-Native Wins the Autonomous Race:", context: "Air-gapped systems can operate without connectivity. Cloud-dependent systems fail in contested environments. Edge-native is the only future-proof architecture." }
                ],
                'ENTERPRISE_EXECUTIVE': [
                    { headline: "Your Burn Rate Is Funding Inefficiency:", context: "A 3-person engineering team costs $750k/year in fully-loaded costs. A $7.5k prototype validates the concept in 48 hours. Time-to-insight matters." },
                    { headline: "Capital Efficiency Drives Valuation:", context: "Companies that achieve product-market fit with <$100k spend get 3x higher valuations. Lean execution signals operational excellence to investors." },
                    { headline: "The ROI of Speed:", context: "Market windows close fast. First-to-market captures 70% of category value. Speed is the ultimate competitive moat in automated economies." },
                    { headline: "Board-Level Risk Exposure:", context: "Every quarter without AI strategy is a board-level risk. Competitors with automation are filing patent applications, building moats, capturing market share." },
                    { headline: "Procurement Delay = Market Loss:", context: "Traditional procurement takes 6-18 months. In that time, 3 competitors will have launched. Procurement processes designed for the 1990s kill 2020s companies." },
                    { headline: "The Automated Economy Rewards Speed:", context: "Companies that can prototype in days instead of quarters capture disproportionate market share. Velocity compounds. Delay is expensive." }
                ],
                'CRISIS_BUYER': [
                    { headline: "Your Timeline Is Already Burning:", context: "You're here because something broke. Every hour costs money. Traditional vendors take weeks just to schedule discovery calls. You need deployment tonight." },
                    { headline: "Competitors Are Moving While You're Frozen:", context: "While you're stuck in crisis mode, your competitors are shipping features, closing deals, and capturing your market share. Crisis delay = permanent loss." },
                    { headline: "The Cost of System Failure:", context: "Downtime costs Fortune 500 companies $300k/hour on average. Manual workarounds are bleeding money. Automation fixes this permanently." },
                    { headline: "Immediate Action = Survival:", context: "In crisis, speed is survival. Companies that react in hours survive. Companies that take months to decide don't. The automated economy has no mercy." },
                    { headline: "Emergency Deployment Saves Quarters:", context: "A 48-hour emergency deployment saves 6 months of traditional vendor cycles. Time saved = competitive advantage preserved. Act now or lose permanently." }
                ]
            },

            init: function() {
                if(this.interval) clearInterval(this.interval);
                if(this.slideInterval) clearInterval(this.slideInterval);

                // Different speeds for different personas
                const vertical = State.vertical;
                let multiplier = 1;
                let speed = 100;

                if(vertical === 'FINANCE') { multiplier = 450; speed = 50; }
                else if(vertical === 'DEFENSE') { multiplier = 1200; speed = 200; }
                else { multiplier = 150; speed = 100; }

                // Debt clock counting up
                this.interval = setInterval(() => {
                    const jump = Math.floor(Math.random() * multiplier);
                    this.value += jump;

                    const el = document.getElementById('ticker-val');
                    if(el) {
                        el.innerText = this.value.toLocaleString();
                        if(jump > (multiplier * 0.8)) {
                            el.style.textShadow = "2px 0 var(--alert), -2px 0 var(--primary)";
                            setTimeout(() => el.style.textShadow = "none", 100);
                        }
                    }
                }, speed);

                // Slide rotation every 6 seconds
                this.rotateSlide();
                this.slideInterval = setInterval(() => this.rotateSlide(), 6000);
            },

            rotateSlide: function() {
                const persona = State.dossier.persona;
                const slides = this.slides[persona] || this.slides['COMMANDER'];

                this.currentSlide = (this.currentSlide + 1) % slides.length;
                const slide = slides[this.currentSlide];

                const headlineEl = document.getElementById('loss-headline');
                const contextEl = document.getElementById('loss-context');

                if (!headlineEl || !contextEl) return;

                // Fade out
                headlineEl.style.opacity = '0';
                contextEl.style.opacity = '0';

                setTimeout(() => {
                    headlineEl.innerText = slide.headline;
                    contextEl.innerText = slide.context;

                    // Fade in
                    headlineEl.style.opacity = '1';
                    contextEl.style.opacity = '1';
                }, 300);
            }
        };

        // 6. RENDERER
        const Renderer = {
            scripts: {
                'GENERAL': {
                    h1: "Your Internal Teams<br>Are Too Slow.<br>I Ship in 48 Hours.",
                    sub: "No agencies. No discovery phases. Just deployment.",
                    build_head: "/// DEPLOYMENT OPTIONS",
                    loss: "/// COST OF INACTION",
                    build_body: "You attempt to hire 3 ML engineers. 6 months pass recruiting. You fire them 8 months later because they built a research paper, not a product.",
                    buy_body: "You sign a 3-year contract. The sales team disappears. You are left with a generic tool that requires 5 consultants to configure.",
                    doc_title: "The Speed of War.",
                    doc_sub: "Most agencies take 6 months to 'discover' what I build in 48 hours. I am not a freelancer; I am a pre-built Autonomous Business Unit.",
                    capsRotations: [
                        [
                            { icon: "[ 01 ]", title: "Zero-Day Architecture", body: "I don't write boilerplate. I deploy a hardened, edge-native core that I've refined over 10 years.", list: ["> Pre-built Auth Systems", "> Auto-Scaling Infrastructure"] },
                            { icon: "[ 02 ]", title: "Procurement Bypass", body: "You aren't hiring an employee. You are purchasing a finished operational result. This bypasses HR and IT gridlock.", list: ["> No Health Benefits", "> No Equity Grants"] },
                            { icon: "[ 03 ]", title: "Full IP Sovereignty", body: "Agencies want to license you their software. I build YOUR software. You own the repo, the data, and the keys.", list: ["> MIT Licensed Delivery", "> No Vendor Lock-in"] }
                        ],
                        [
                            { icon: "[ 01 ]", title: "Battle-Tested Stack", body: "This isn't theoretical. These are systems I've deployed in production for defense contractors and logistics firms.", list: ["> 10,000+ Hours Logged", "> Real-World Stress Testing"] },
                            { icon: "[ 02 ]", title: "Deploy in 48 Hours", body: "No discovery phases. No endless meetings. I arrive with pre-validated architecture ready to adapt to your environment.", list: ["> Containerized Deployment", "> Infrastructure as Code"] },
                            { icon: "[ 03 ]", title: "You Own Everything", body: "Code, keys, data, models. Nothing is SaaS. Nothing requires my permission to modify. Complete operational sovereignty.", list: ["> Full Source Access", "> Zero Runtime Fees"] }
                        ],
                        [
                            { icon: "[ 01 ]", title: "No Agency Overhead", body: "You're not paying for account managers, project coordinators, or discovery workshops. Just pure engineering output.", list: ["> Direct Technical Access", "> Zero Management Layers"] },
                            { icon: "[ 02 ]", title: "Operational From Day 1", body: "Most contractors deliver documentation. I deliver running systems. If it doesn't boot, you don't pay.", list: ["> Dockerized Delivery", "> Health Checks Included"] },
                            { icon: "[ 03 ]", title: "Built for Handoff", body: "Every system is documented, tested, and designed for your team to own. I'm not creating dependency; I'm transferring capability.", list: ["> README-Driven Design", "> Inline Documentation"] }
                        ],
                        [
                            { icon: "[ 01 ]", title: "Risk Reversal Guarantee", body: "If the system doesn't meet spec, full refund. You keep the IP either way. Zero downside.", list: ["> Money-Back Guarantee", "> Keep All Code"] },
                            { icon: "[ 02 ]", title: "Production-Grade Security", body: "Every stack includes auth, encryption, audit logs, and RBAC from day one. Security isn't a phase 2 feature.", list: ["> JWT Token Auth", "> AES-256 Encryption"] },
                            { icon: "[ 03 ]", title: "Scalable Architecture", body: "Systems designed to handle 10x traffic from launch. Auto-scaling, load balancing, and graceful degradation built in.", list: ["> Horizontal Scaling Ready", "> Circuit Breakers Included"] }
                        ]
                    ],
                    caps: [] // Legacy support, will be populated from first rotation
                },
                'DEFENSE': {
                    h1: "Autonomous Systems.<br>Deployed Downrange.",
                    sub: "Edge-native hardware integration. No cloud dependencies. 15ms Latency guaranteed.",
                    build_head: "/// TACTICAL DEPLOYMENT OPTIONS",
                    loss: "/// THREATS MISSED",
                    build_body: "Your internal team tries to run PyTorch on a Raspberry Pi. It crashes. The mission fails because they relied on cloud APIs.",
                    buy_body: "You buy Palantir. It costs $5M/year. You can't export your own data. You are locked in forever.",
                    doc_title: "Kinetic Operations Require Edge Logic.",
                    doc_sub: "You cannot rely on AWS in a contested environment. My architecture is designed for air-gapped, low-power, high-stakes deployment zones.",
                    capsRotations: [
                        [
                            { icon: "///", title: "Air-Gapped Native", body: "Systems built to function with zero connectivity. Local inference, local storage, local decision making.", list: ["> Quantized Models (int8)", "> Jetson / RPi Optimization", "> LoRaWAN Telemetry"] },
                            { icon: "///", title: "NIST 800-53 Compliance", body: "Security isn't an afterthought. It's baked into the Docker container from line one.", list: ["> FIPS 140-2 Encrypted Storage", "> Role-Based Access Control"] },
                            { icon: "///", title: "Sensor Fusion", body: "AIME ingests data from disparate hardware sources without custom drivers.", list: ["> RTSP Video Streams", "> SDR / RF Signal Data"] }
                        ],
                        [
                            { icon: "///", title: "Contested Environment Ready", body: "No cloud dependencies means no points of failure. Systems operate in denied, degraded, intermittent environments.", list: ["> Offline-First Architecture", "> Local Model Inference"] },
                            { icon: "///", title: "Low-Power Optimization", body: "Deployments run on battery power for 72+ hours. Quantized models reduce compute requirements by 4x.", list: ["> TensorRT Optimization", "> ARM64 Native Builds"] },
                            { icon: "///", title: "Tactical Data Exfil", body: "Compressed telemetry over low-bandwidth channels. Systems designed for 4G LTE, Satcom, or mesh networks.", list: ["> Protobuf Compression", "> Mesh Network Support"] }
                        ],
                        [
                            { icon: "///", title: "Computer Vision at Edge", body: "Real-time object detection on Jetson hardware. No cloud upload required. Decisions made in <20ms.", list: ["> YOLOv8 Quantized", "> CUDA Acceleration"] },
                            { icon: "///", title: "Encrypted Communications", body: "All inter-system communication uses military-grade encryption. Keys rotated per mission.", list: ["> AES-256-GCM", "> Perfect Forward Secrecy"] },
                            { icon: "///", title: "Redundant Systems", body: "Failover architecture with watchdog monitoring. If primary fails, backup assumes control automatically.", list: ["> Heartbeat Monitoring", "> Auto-Failover Logic"] }
                        ],
                        [
                            { icon: "///", title: "Rapid Deployment Kits", body: "Pre-configured hardware arrives ready to boot. Flash SD card, connect power, operational in <5 minutes.", list: ["> Pre-Imaged Systems", "> Zero-Touch Provisioning"] },
                            { icon: "///", title: "Mission-Specific Training", body: "Transfer learning allows rapid model adaptation. Retrain detection models on new targets in <2 hours.", list: ["> TensorFlow Lite", "> Custom Dataset Ingestion"] },
                            { icon: "///", title: "Operational Security", body: "Zero telemetry to third parties. No analytics. No usage tracking. Complete operational silence.", list: ["> No External DNS", "> Localhost-Only APIs"] }
                        ]
                    ],
                    caps: [] // Legacy support, will be populated from first rotation
                },
                'LOGISTICS': {
                    h1: "Supply Chain Logic.<br>Without The ERP Bloat.",
                    sub: "Bypass legacy systems. Real-time visibility. NIST 800-53 Compliant.",
                    build_head: "/// SUPPLY CHAIN OPTIONS",
                    loss: "/// EFFICIENCY BLEED",
                    build_body: "IT tries to integrate with the ERP. They spend 9 months in meetings mapping database schemas. Nothing ships.",
                    buy_body: "You buy SAP. It takes 2 years to implement. Your staff hates it. You go back to Excel spreadsheets.",
                    doc_title: "Stop Fighting The ERP.",
                    doc_sub: "I build 'Sidecar Architectures' that sit on top of your legacy mess. We don't ask IT for permission; we ingest their read-only views and build the actual value.",
                    capsRotations: [
                        [
                            { icon: ">>", title: "The ERP Bypass", body: "We don't rewrite your SAP/Oracle instance. We wrap it in a modern API layer that actually works.", list: ["> Read-Only SQL Mirroring", "> CSV/EDI Ingestion Parsers"] },
                            { icon: ">>", title: "Real-Time Asset Tracking", body: "Stop waiting for the nightly batch job. Get websocket-driven live maps of your inventory.", list: ["> Mapbox / Geospatial Integration", "> Mobile Driver Interfaces"] },
                            { icon: ">>", title: "Driver-First UX", body: "Warehouse workers have fat fingers and bad internet. My UIs are big, high-contrast, and offline-first.", list: ["> PWA (Installable App)", "> Voice Input Support"] }
                        ],
                        [
                            { icon: ">>", title: "Predictive Demand Modeling", body: "ML models analyze historical patterns to forecast stockouts before they happen. No more emergency orders.", list: ["> LSTM Time Series", "> Seasonal Decomposition"] },
                            { icon: ">>", title: "Route Optimization Engine", body: "Traveling salesman algorithms run in real-time. Drivers get optimal routes that save hours per day.", list: ["> Google OR-Tools", "> Dynamic Re-Routing"] },
                            { icon: ">>", title: "Barcode & RFID Integration", body: "Scan once, update everywhere. Inventory counts sync across warehouses instantly.", list: ["> Zebra Scanner Support", "> NFC Tag Reading"] }
                        ],
                        [
                            { icon: ">>", title: "Cross-Dock Automation", body: "Incoming shipments auto-matched to outgoing orders. Zero warehouse storage time. Pure velocity.", list: ["> AI Matching Logic", "> Dock Door Scheduling"] },
                            { icon: ">>", title: "Carrier Rate Shopping", body: "Automated API calls to FedEx, UPS, USPS. Always get the cheapest rate for each shipment.", list: ["> Multi-Carrier APIs", "> Real-Time Rate Comparison"] },
                            { icon: ">>", title: "Exception Handling Alerts", body: "When a shipment goes off-plan, you know immediately. SMS, Slack, or email alerts with actionable context.", list: ["> Twilio Integration", "> Smart Alert Filtering"] }
                        ],
                        [
                            { icon: ">>", title: "Warehouse Heatmaps", body: "Visual dashboards showing where bottlenecks occur. Data-driven layout optimization.", list: ["> D3.js Visualizations", "> Historical Pattern Analysis"] },
                            { icon: ">>", title: "Labor Productivity Metrics", body: "Track picks-per-hour, pack-rates, and accuracy. Gamification leaderboards increase output by 20%.", list: ["> Real-Time Dashboards", "> Performance Leaderboards"] },
                            { icon: ">>", title: "Compliance & Audit Trails", body: "Every scan, every move, every decision logged immutably. FDA, ISO, and SOC 2 ready.", list: ["> Append-Only Logs", "> Automated Report Generation"] }
                        ]
                    ],
                    caps: [] // Legacy support, will be populated from first rotation
                },
                'FINANCE': {
                    h1: "Automated Capital.<br>Zero Overhead.",
                    sub: "Scrape, aggregate, and analyze funding sources. 10x faster than human analysts.",
                    build_head: "/// CAPITAL ACQUISITION OPTIONS",
                    loss: "/// CAPITAL LOST",
                    build_body: "You hire interns to scrape data. They miss the biggest grants. The data is stale by the time you see it.",
                    buy_body: "You buy Bloomberg Terminal access. It's $24k/year per seat. It doesn't integrate with your CRM.",
                    doc_title: "Information Asymmetry is Profit.",
                    doc_sub: "While your competitors are manually checking government portals, my scrapers have already indexed, categorized, and scored every new opportunity.",
                    capsRotations: [
                        [
                            { icon: "$", title: "Aggressive Data Ingestion", body: "I build headless browser clusters that navigate complex portals, CAPTCHAs, and paywalls.", list: ["> Playwright / Puppeteer Clusters", "> Residential Proxy Rotation"] },
                            { icon: "$", title: "LLM Analysis Layer", body: "Raw data is useless. My stack includes local LLMs that read the RFP and score it against your criteria.", list: ["> RAG (Retrieval Augmented Gen)", "> Semantic Search Vectors"] },
                            { icon: "$", title: "Zero-Latency Alerts", body: "When a grant drops, you know in seconds via SMS, Slack, or Email.", list: ["> Webhook Integrations", "> Twilio API Connected"] }
                        ],
                        [
                            { icon: "$", title: "Multi-Source Aggregation", body: "Monitor 50+ funding databases simultaneously. SBIR, NIR, VC funds, accelerator programs - all in one dashboard.", list: ["> API Polling", "> RSS Feed Monitoring"] },
                            { icon: "$", title: "Automated Application Drafting", body: "LLM-generated first drafts for grant applications. Saves 80% of proposal writing time.", list: ["> GPT-4 Integration", "> Template Library"] },
                            { icon: "$", title: "Fit Score Ranking", body: "Each opportunity scored against your business profile. Only see grants you can actually win.", list: ["> Machine Learning Classifier", "> Historical Win Rate Analysis"] }
                        ],
                        [
                            { icon: "$", title: "Deadline Enforcement", body: "Auto-escalating reminders ensure you never miss a submission window. Slack pings get louder as deadlines approach.", list: ["> Calendar Integration", "> Priority Queues"] },
                            { icon: "$", title: "Competitor Intelligence", body: "Track which companies are winning similar grants. Learn from their public disclosures.", list: ["> SEC Filing Scrapes", "> FOIA Request Automation"] },
                            { icon: "$", title: "Document Generation", body: "Auto-populate application forms from your database. Financial projections, team bios, technical specs - all templated.", list: ["> PDF Form Filling", "> Docx Templating"] }
                        ],
                        [
                            { icon: "$", title: "Historical Award Tracking", body: "Database of past winners, award amounts, and selection criteria. Pattern recognition reveals what reviewers prioritize.", list: ["> Data Warehousing", "> Trend Analysis Dashboards"] },
                            { icon: "$", title: "Compliance Verification", body: "Automated checks for eligibility requirements. System flags disqualifiers before you waste time applying.", list: ["> Rules Engine", "> Pre-Submission Validation"] },
                            { icon: "$", title: "ROI Projection", body: "Calculate expected value for each opportunity. Time-to-award, probability of success, and funding amount factored.", list: ["> Monte Carlo Simulations", "> Expected Value Rankings"] }
                        ]
                    ],
                    caps: [] // Legacy support, will be populated from first rotation
                },
                'CYBER': {
                    h1: "Threat Detection.<br>Before The Breach.",
                    sub: "Automated compliance and anomaly detection. Self-healing architecture.",
                    build_head: "/// SECURITY DEPLOYMENT OPTIONS",
                    loss: "/// DATA EXPOSED",
                    build_body: "Your SecOps team installs an open-source tool. They drown in false positives. Real threats slip through the noise.",
                    buy_body: "You buy Splunk. The ingestion costs bankrupt your budget. You turn off logging to save money.",
                    doc_title: "Silence The Noise.",
                    doc_sub: "Security tools generate too many logs. My system uses unsupervised learning to ignore the normal and only alert you on the mathematically impossible.",
                    capsRotations: [
                        [
                            { icon: "(!)", title: "Isolation Forest Detection", body: "We don't use static rules. We use ML to learn what 'normal' network traffic looks like.", list: ["> Anomaly Scoring", "> Packet Header Analysis"] },
                            { icon: "(!)", title: "Automated Compliance", body: "Stop taking screenshots for auditors. My system generates the PDF compliance report automatically.", list: ["> Daily PDF Reports", "> Immutable Log Storage"] },
                            { icon: "(!)", title: "Self-Healing Containers", body: "If a service acts weird, the system kills it and respawns a fresh version. Automatically.", list: ["> Docker Healthchecks", "> Auto-Restart Policies"] }
                        ],
                        [
                            { icon: "(!)", title: "Zero-Trust Architecture", body: "Every request is authenticated. No implicit trust zones. Breach containment by design.", list: ["> mTLS Certificate Auth", "> Request Signing Required"] },
                            { icon: "(!)", title: "Threat Intelligence Feeds", body: "Real-time ingestion of OSINT threat feeds. Block known malicious IPs before they probe.", list: ["> AlienVault OTX Integration", "> Auto-Blacklist Updates"] },
                            { icon: "(!)", title: "Incident Response Automation", body: "When an anomaly is detected, the system auto-quarantines, logs, and alerts. No human delay.", list: ["> Automatic Network Segmentation", "> Slack/PagerDuty Webhooks"] }
                        ],
                        [
                            { icon: "(!)", title: "Encrypted Data at Rest", body: "All data encrypted with AES-256. Keys rotated monthly. No plaintext ever touches disk.", list: ["> FIPS 140-2 Compliant", "> HSM Key Storage"] },
                            { icon: "(!)", title: "Audit Log Immutability", body: "Logs written to append-only storage. Even root can't delete. Perfect for compliance audits.", list: ["> Blockchain-Style Hashing", "> Tamper-Proof Timestamps"] },
                            { icon: "(!)", title: "Penetration Test Ready", body: "Systems designed to survive red team attacks. Defense-in-depth is baked in, not bolted on.", list: ["> Rate Limiting", "> Input Sanitization"] }
                        ],
                        [
                            { icon: "(!)", title: "Real-Time Threat Dashboards", body: "Live maps of attack vectors. See who's probing, from where, and what they're targeting.", list: ["> GeoIP Attack Mapping", "> Live Packet Inspection"] },
                            { icon: "(!)", title: "False Positive Suppression", body: "ML-based filtering learns your environment. Only alerts on statistically significant anomalies.", list: ["> Bayesian Filtering", "> Adaptive Thresholds"] },
                            { icon: "(!)", title: "Compliance Export Engine", body: "One-click export to SOC 2, ISO 27001, or NIST formats. Auditors get what they need instantly.", list: ["> Multi-Format Reports", "> Automated Evidence Collection"] }
                        ]
                    ],
                    caps: [] // Legacy support, will be populated from first rotation
                }
            },

            capRotationIndex: 0,
            capRotationInterval: null,

            updateContent: function(persona, vertical) {
                const script = this.scripts[vertical] || this.scripts['GENERAL'];

                if(persona === 'CRISIS_BUYER') {
                    document.querySelector('.dynamic-hero').innerHTML = "System Critical?<br><span style='color:var(--alert)'>Deploy Tonight.</span>";
                    document.getElementById('hero-badge').innerText = "EMERGENCY RESPONSE AVAILABLE";
                    document.getElementById('hero-badge').style.borderColor = 'var(--alert)';
                    document.getElementById('hero-badge').style.color = 'var(--alert)';
                } else {
                    document.querySelector('.dynamic-hero').innerHTML = script.h1;
                    document.getElementById('hero-badge').innerText = "OPERATIONAL READINESS";
                    document.getElementById('hero-badge').style.borderColor = '';
                    document.getElementById('hero-badge').style.color = '';
                }

                document.querySelector('.dynamic-subhero').innerHTML = script.sub;
                document.getElementById('build-buy-header').textContent = script.build_head;
                document.getElementById('loss-label').textContent = script.loss;
                document.getElementById('persona-label').textContent = `${vertical} // ${persona}`;

                document.getElementById('doctrine-title').innerText = script.doc_title;
                document.getElementById('doctrine-sub').innerText = script.doc_sub;

                // Start capability rotation if this vertical has multiple cap sets
                if (script.capsRotations && script.capsRotations.length > 0) {
                    // Set initial caps from first rotation
                    this.capRotationIndex = 0;

                    // Clear old rotation
                    if (this.capRotationInterval) clearInterval(this.capRotationInterval);

                    // Render initial capability cards
                    this.renderCaps(script.capsRotations[0]);

                    // Start rotation every 5 seconds (more aggressive)
                    this.capRotationInterval = setInterval(() => {
                        this.rotateCaps(script);
                    }, 5000);

                    // Add click handler to capability grid - click to instantly rotate
                    const capGrid = document.getElementById('capability-grid');
                    if (capGrid) {
                        capGrid.onclick = () => {
                            this.rotateCaps(script);
                            AudioController.play('click');
                        };
                        capGrid.style.cursor = 'pointer';
                    }
                } else if (script.caps && script.caps.length > 0) {
                    // Legacy support for verticals without capsRotations
                    this.renderCaps(script.caps);
                }

                // VALUE-BASED PRICING MATRIX
                // Show real agency comparisons to anchor the value proposition
                const buildCost = vertical === 'DEFENSE' ? '$2.4M' : vertical === 'FINANCE' ? '$2.1M' : vertical === 'CYBER' ? '$2.6M' : '$1.8M';
                const buyCost = vertical === 'DEFENSE' ? '$3.2M' : vertical === 'FINANCE' ? '$3.5M' : vertical === 'CYBER' ? '$2.4M' : '$2.8M';

                const matrixHTML = `
                <div class="matrix-card" style="border-color: #FF0000;">
                    <div class="matrix-title" style="color: #FF0000;">Option 1: Build In-House</div>
                    <div class="matrix-body">${script.build_body}</div>
                    <div class="matrix-verdict" style="color: #FF0000;">5-YEAR TCO: ${buildCost}</div>
                    <div style="font-size:0.65rem; margin-top:8px; opacity:0.7;">3 Engineers × $150k/yr + Infrastructure + 20% Failure Rate</div>
                </div>
                <div class="matrix-card" style="border-color: #FFA500;">
                    <div class="matrix-title" style="color: #FFA500;">Option 2: Buy Enterprise</div>
                    <div class="matrix-body">${script.buy_body}</div>
                    <div class="matrix-verdict" style="color: #FFA500;">5-YEAR TCO: ${buyCost}</div>
                    <div style="font-size:0.65rem; margin-top:8px; opacity:0.7;">SaaS Subscription + Implementation + Vendor Lock-in Forever</div>
                </div>
                <div class="matrix-card" style="border-color: var(--primary); background: rgba(0,255,65,0.03); transform: scale(1.05); box-shadow: 0 0 30px rgba(0,255,65,0.1); position: relative;">
                    <div style="position:absolute; top:-10px; right:10px; background:var(--primary); color:#000; font-size:0.65rem; padding:3px 10px; font-weight:bold; font-family:var(--mono-font);">RECOMMENDED</div>
                    <div class="matrix-title" style="color: var(--primary);">Option 3: AIME Intelligence</div>
                    <div class="matrix-body">48-hour prototype delivery. You own the code, keys, and data. No vendor lock-in. Pre-validated architecture ready to deploy.</div>
                    <div class="matrix-verdict" style="color: var(--primary);">INVESTMENT: $7,500 - $12,950</div>
                    <div style="font-size:0.65rem; margin-top:8px; color:var(--primary);">Pay Once. Own Forever. 6.5x ROI vs. Agencies.</div>
                </div>
                <div class="matrix-card" style="border-color: #FFD700; background: rgba(255,215,0,0.05); position: relative; opacity: 0.92;">
                    <div style="position:absolute; top:-10px; right:10px; background:#FFD700; color:#000; font-size:0.65rem; padding:3px 10px; font-weight:bold; font-family:var(--mono-font);">PREMIUM TIER</div>
                    <div style="position: absolute; top: 10px; left: 10px; background: rgba(255,215,0,0.2); color: #FFD700; padding: 4px 12px; font-family: var(--mono-font); font-size: 0.6rem; border: 1px solid #FFD700; font-weight: bold;">LIMITED AVAILABILITY</div>
                    <div class="matrix-title" style="color: #FFD700; margin-top: 30px;">Option 4: Fractional CTO</div>
                    <div class="matrix-body" style="color: #f0f0f0;">Full operational command for 30 days. I embed with your team as acting CTO. Strategic architecture, system design, team mentorship, and complete technical leadership. Max 2 clients simultaneously.</div>
                    <div class="matrix-verdict" style="color: #FFD700; font-size: 1.1rem;">RETAINER: $25,000/MONTH</div>
                    <div style="font-size:0.7rem; margin-top:8px; color: #FFD700; font-weight: 600;">Effective Rate: $1,250/hr • Board-Level Strategic Value</div>
                    <div style="font-size:0.65rem; margin-top:8px; opacity:0.8; color: #e0e0e0;">What you get: Architecture reviews, technical roadmaps, vendor negotiations, hiring strategy, security audits, and direct engineering execution.</div>
                </div>`;
                document.getElementById('matrix-container').innerHTML = matrixHTML;

                document.body.className = ''; 
                if(persona === 'TECHNICAL_DECISION_MAKER') document.body.classList.add('mode-tech');
                if(persona === 'CRISIS_BUYER') document.body.classList.add('mode-crisis');
                if(persona === 'ENTERPRISE_EXECUTIVE') document.body.classList.add('mode-exec');

                ContentMorpher.check(persona);
            },

            renderCaps: function(caps) {
                const container = document.getElementById('capability-grid');
                if (!container || !caps || caps.length === 0) return;

                container.innerHTML = caps.map(cap => `
                    <div class="card-holo">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.5;">${cap.icon}</div>
                        <div style="font-size: 0.9rem; font-weight: bold; margin-bottom: 0.5rem; font-family: var(--mono-font);">${cap.title}</div>
                        <div style="font-size: 0.75rem; line-height: 1.4; margin-bottom: 0.5rem; opacity: 0.8;">${cap.body}</div>
                        <div style="font-size: 0.65rem; opacity: 0.6; font-family: var(--mono-font);">
                            ${cap.list.map(item => `<div>${item}</div>`).join('')}
                        </div>
                    </div>
                `).join('');
            },

            rotateCaps: function(script) {
                if (!script.capsRotations || script.capsRotations.length === 0) return;

                // Cycle to next set
                this.capRotationIndex = (this.capRotationIndex + 1) % script.capsRotations.length;
                const nextCaps = script.capsRotations[this.capRotationIndex];

                const container = document.getElementById('capability-grid');
                if (!container) return;

                // Fade out
                container.style.opacity = '0';
                container.style.transition = 'opacity 300ms ease';

                setTimeout(() => {
                    // Render new caps
                    this.renderCaps(nextCaps);

                    // Fade in
                    container.style.opacity = '1';
                }, 300);
            }
        };

        // 6.5. HERO ROTATOR (Cycles through value props)
        const HeroRotator = {
            messages: {
                'COMMANDER': [
                    // THE CORE MESSAGE - appears 3x more often by repetition
                    { h1: "Your Internal Teams<br>Are Too Slow.<br>I Ship in 48 Hours.", sub: "No agencies. No discovery phases. Just deployment." },
                    { h1: "Your Internal Teams<br>Are Too Slow.<br>I Ship in 48 Hours.", sub: "While your team plans meetings, I'm deploying systems." },
                    { h1: "Your Internal Teams<br>Are Too Slow.<br>I Ship in 48 Hours.", sub: "Operational code delivered in 48 hours. Not quarters. Hours." },
                    { h1: "Bypass Procurement.<br>Own The Code.", sub: "While your team waits for approval, I'm already shipping." },
                    { h1: "Your Internal Teams<br>Are Too Slow.<br>I Ship in 48 Hours.", sub: "Pre-built systems. Zero discovery phase. Immediate deployment." },
                    { h1: "48-Hour Prototypes.<br>Zero Risk.", sub: "Full refund if not functional. You keep the IP either way." },
                    { h1: "Your Internal Teams<br>Are Too Slow.<br>I Ship in 48 Hours.", sub: "Speed is the ultimate competitive moat. I deploy while others plan." }
                ],
                'TECHNICAL_DECISION_MAKER': [
                    { h1: "Your Internal Teams<br>Are Too Slow.<br>I Ship in 48 Hours.", sub: "Edge-native architecture. Deployed in 48 hours, not 48 weeks." },
                    { h1: "Edge-Native Architecture.<br>15ms Latency Guaranteed.", sub: "Air-gapped systems. Quantized models. Zero cloud dependencies." },
                    { h1: "Your Internal Teams<br>Are Too Slow.<br>I Ship in 48 Hours.", sub: "Pre-validated stacks. NIST 800-53 compliant from day one." },
                    { h1: "No Boilerplate.<br>Just Hardened Infrastructure.", sub: "Pre-validated auth, auto-scaling, NIST 800-53 compliance baked in." },
                    { h1: "Own The Repo.<br>Own The Keys.", sub: "MIT licensed delivery. No vendor lock-in. Full IP sovereignty." },
                    { h1: "Real Code.<br>Not Research Papers.", sub: "Production-ready systems. Not academic experiments." }
                ],
                'CRISIS_BUYER': [
                    { h1: "System Critical?<br><span style='color:var(--alert)'>Deploy Tonight.</span>", sub: "Emergency response available. Immediate engagement." },
                    { h1: "Your Timeline Is Burning.<br><span style='color:var(--alert)'>I Ship Now.</span>", sub: "No meetings. No discovery. Just deployment." },
                    { h1: "<span style='color:var(--alert)'>Competitors Move Faster.</span><br>Stop Losing.", sub: "Every day you wait costs thousands. Lock in capacity now." }
                ],
                'ENTERPRISE_EXECUTIVE': [
                    { h1: "Your Internal Teams<br>Are Too Slow.<br>I Ship in 48 Hours.", sub: "$7.5k buys what agencies charge $120k+ for. Speed = ROI." },
                    { h1: "$7.5k vs. $2.4M.<br>Same Result.", sub: "Why pay enterprise rates for a solo contractor's output?" },
                    { h1: "Your Internal Teams<br>Are Too Slow.<br>I Ship in 48 Hours.", sub: "Capital efficiency drives valuation. Lean execution wins." },
                    { h1: "Bypass The Bullshit.<br>Deploy The Solution.", sub: "No agencies. No consultants. No 6-month discovery phases." },
                    { h1: "Your Internal Teams<br>Are Too Slow.<br>I Ship in 48 Hours.", sub: "First to market captures 70% of category value. Ship NOW." }
                ]
            },
            currentIndex: 0,
            currentPersona: 'COMMANDER',
            interval: null,
            hoverTimeout: null,

            init: function() {
                const heroEl = document.querySelector('.dynamic-hero');
                const subEl = document.querySelector('.dynamic-subhero');

                // Auto-cycle with variable timing - hold core message longer
                this.scheduledCycle();
            },

            scheduledCycle: function() {
                const heroEl = document.querySelector('.dynamic-hero');
                const currentMsg = this.messages[State.dossier.persona][this.currentIndex];

                // If current message is the core "Your Internal Teams Are Too Slow" message
                // Hold it for 5 seconds instead of 3
                const holdTime = currentMsg.h1.includes("Your Internal Teams") ? 5000 : 3000;

                this.interval = setTimeout(() => {
                    this.cycle();
                    this.scheduledCycle(); // Schedule next cycle
                }, holdTime);

                // Hover triggers immediate cycle + 2-second pause
                heroEl.addEventListener('mouseenter', () => {
                    clearTimeout(this.interval);
                    this.cycle();

                    clearTimeout(this.hoverTimeout);
                    this.hoverTimeout = setTimeout(() => {
                        this.scheduledCycle();
                    }, 2000);
                });
            },

            cycle: function() {
                const persona = State.dossier.persona;
                const messages = this.messages[persona] || this.messages['COMMANDER'];

                // If persona changed, reset index
                if (persona !== this.currentPersona) {
                    this.currentIndex = 0;
                    this.currentPersona = persona;
                }

                this.currentIndex = (this.currentIndex + 1) % messages.length;
                const msg = messages[this.currentIndex];

                const heroEl = document.querySelector('.dynamic-hero');
                const subEl = document.querySelector('.dynamic-subhero');

                // Fade out
                heroEl.style.opacity = '0';
                subEl.style.opacity = '0';

                setTimeout(() => {
                    heroEl.innerHTML = msg.h1;
                    subEl.innerHTML = msg.sub;

                    // Fade in
                    heroEl.style.opacity = '1';
                    subEl.style.opacity = '1';
                }, 300);
            },

            updatePersona: function(persona) {
                this.currentPersona = persona;
                this.currentIndex = 0;
                this.cycle();
            }
        };

        // 7. CONTENT MORPHER
        const ContentMorpher = {
            injected: new Set(),
            intervals: [],
            bootGracePeriod: Date.now(),
            init: function() { setInterval(() => this.check(State.dossier.persona), 2000); },
            clearIntervals: function() { this.intervals.forEach(i => clearInterval(i)); this.intervals = []; },

            check: function(p) {
                // Brief 1-second grace period (prevents flash on page load only)
                const secondsSinceBoot = (Date.now() - this.bootGracePeriod) / 1000;
                if (secondsSinceBoot < 1) {
                    return;
                }

                if(p==='TECHNICAL_DECISION_MAKER' && !this.injected.has('tech')) { this.clearIntervals(); this.injectTech(); this.injected.add('tech'); }
                else if(p==='ENTERPRISE_EXECUTIVE' && !this.injected.has('exec')) { this.clearIntervals(); this.injectExec(); this.injected.add('exec'); }
                else if(p==='CRISIS_BUYER' && !this.injected.has('crisis')) { this.clearIntervals(); this.injectCrisis(); this.injected.add('crisis'); }
            },
            
            injectTech: function() {
                const s=document.createElement('section'); s.className='container'; s.style.animation='fadeIn 0.5s'; s.style.marginTop='40px';
                s.innerHTML = `
                    <div class="grid-header">/// LIVE LATENCY STREAM</div>
                    <canvas id="perf-chart" style="height:200px;border:1px dashed var(--primary)"></canvas>
                    <div style="margin-top:30px; padding:25px; border:1px solid var(--primary); background:rgba(0,255,65,0.02);">
                        <div id="tech-closer" style="font-size:1rem; color:var(--primary); font-family:var(--mono-font); min-height:60px; line-height:1.5;"></div>
                    </div>
                `;
                document.getElementById('injected-content').innerHTML = '';
                document.getElementById('injected-content').appendChild(s);
                this.drawTechChart();
                this.typewriterTech();
            },
            injectExec: function() {
                const s=document.createElement('section'); s.className='container'; s.style.animation='fadeIn 0.5s'; s.style.marginTop='40px';
                s.innerHTML = `
                    <div class="grid-header">/// 5-YEAR COST ANALYSIS</div>
                    <canvas id="roi-chart" style="height:250px;border:1px solid var(--border);background:rgba(255,255,255,0.02)"></canvas>
                    <div style="margin-top:30px; padding:25px; border:1px solid var(--primary); background:rgba(0,255,65,0.02);">
                        <div id="exec-closer" style="font-size:1rem; color:var(--primary); font-family:var(--mono-font); min-height:60px; line-height:1.5;"></div>
                    </div>
                `;
                document.getElementById('injected-content').innerHTML = '';
                document.getElementById('injected-content').appendChild(s);
                this.drawExecChart();
                this.typewriterExec();
            },

            typewriterTech: function() {
                const messages = [
                    "Cloud architectures fail in contested environments. Edge-native = operational sovereignty. Deploy once, run forever. No vendor lock-in. No monthly fees. Just code that WORKS.",

                    "Your stack is aging while competitors deploy quantized models at 15ms latency. Every day on legacy infrastructure = 6 months of technical debt. Migrate NOW or get left behind.",

                    "Pre-validated architecture ships in 48 hours. While your team debates frameworks, I'm already deploying NIST 800-53 compliant containers. Speed wins wars.",

                    "Open source = freedom. MIT licensed delivery means you OWN the repo, the keys, the future. No SaaS subscriptions bleeding your budget. Pay once. Deploy forever."
                ];

                this.startTypewriterCycle('tech-closer', messages, 25);
            },

            typewriterExec: function() {
                const messages = [
                    "ROI in 48 hours, not 18 months. $7.5k prototype validates the concept faster than a single sprint planning meeting. Time-to-insight is your competitive moat.",

                    "Build in-house = $2.4M over 5 years. Buy enterprise = $3.2M vendor lock-in. AIME Intelligence = $7.5k one-time. The math is obvious. Act decisively.",

                    "Capital efficiency drives valuation. Investors reward lean execution. Companies that achieve product-market fit under $100k spend get 3x higher valuations. This is board-level strategy.",

                    "First-to-market captures 70% of category value. Your procurement process was designed for the 1990s. It will kill your 2025 company. Bypass it. Ship NOW."
                ];

                this.startTypewriterCycle('exec-closer', messages, 25);
            },

            startTypewriterCycle: function(elementId, messages, speed = 30) {
                let currentMessageIndex = 0;
                let isTyping = false;

                const typeMessage = () => {
                    const el = document.getElementById(elementId);
                    if (!el || isTyping) return;

                    isTyping = true;
                    const message = messages[currentMessageIndex];
                    el.innerHTML = '';

                    let charIndex = 0;
                    const typingInterval = setInterval(() => {
                        if (!document.getElementById(elementId)) {
                            clearInterval(typingInterval);
                            return;
                        }

                        if (charIndex < message.length) {
                            el.innerHTML += message[charIndex];
                            charIndex++;
                        } else {
                            clearInterval(typingInterval);
                            isTyping = false;

                            // Move to next message after 7 seconds
                            setTimeout(() => {
                                currentMessageIndex = (currentMessageIndex + 1) % messages.length;
                                typeMessage();
                            }, 7000);
                        }
                    }, speed);

                    this.intervals.push(typingInterval);
                };

                typeMessage();
            },
            injectCrisis: function() {
                const s=document.createElement('section'); s.className='container'; s.style.animation='pulse 1s infinite'; s.style.marginTop='40px';
                s.innerHTML = `
                    <div class="grid-header" style="color:var(--alert)">/// URGENT: COMPETITIVE THREAT ANALYSIS</div>
                    <div style="font-size:4rem;text-align:center;font-family:var(--mono-font);color:var(--alert);" id="countdown"></div>
                    <div style="margin-top:30px; padding:30px; border:2px dashed var(--alert); background:rgba(255,0,0,0.05);">
                        <div id="crisis-message" style="font-size:1.2rem; color:var(--alert); font-family:var(--mono-font); min-height:80px; line-height:1.6;"></div>
                    </div>
                `;
                document.getElementById('injected-content').innerHTML = '';
                document.getElementById('injected-content').appendChild(s);
                this.startTimer();
                this.typewriterCrisis();
            },

            typewriterCrisis: function() {
                const messages = [
                    "YOUR COMPETITORS ARE DEPLOYING AI RIGHT NOW. While you're reading this, they're automating systems you still run manually. Every day you delay = 3 weeks of catch-up work. Lock in capacity NOW.",

                    "PROCUREMENT DELAY = MARKET LOSS. Traditional vendor cycles take 6-18 months. Your competition isn't waiting. They're shipping features while you're scheduling discovery calls. Act immediately or lose permanently.",

                    "YOU'RE BLEEDING $50K+ PER MONTH in manual operations that could be automated in 48 hours. That's $600,000/year in pure waste. How much longer can you afford to wait?",

                    "THIS PRICING WON'T LAST. Capacity is filling. The $7.5k slots will be $12k next quarter. Emergency surge pricing is ALREADY active. Secure your deployment window before it closes.",

                    "YOUR BOARD IS ASKING WHY YOU DON'T HAVE AN AI STRATEGY. Every quarter without automation is a board-level risk. Competitors are filing patents, building moats, capturing YOUR market share. This is your last chance to catch up."
                ];

                let currentMessageIndex = 0;
                let isTyping = false;

                const typeMessage = () => {
                    const el = document.getElementById('crisis-message');
                    if (!el || isTyping) return;

                    isTyping = true;
                    const message = messages[currentMessageIndex];
                    el.innerHTML = '';

                    let charIndex = 0;
                    const typingInterval = setInterval(() => {
                        if (!document.getElementById('crisis-message')) {
                            clearInterval(typingInterval);
                            return;
                        }

                        if (charIndex < message.length) {
                            el.innerHTML += message[charIndex];
                            charIndex++;
                        } else {
                            clearInterval(typingInterval);
                            isTyping = false;

                            // Move to next message after 8 seconds
                            setTimeout(() => {
                                currentMessageIndex = (currentMessageIndex + 1) % messages.length;
                                typeMessage();
                            }, 8000);
                        }
                    }, 30); // Type at 30ms per character

                    this.intervals.push(typingInterval);
                };

                typeMessage();
            },
            drawTechChart: function() {
                const c=document.getElementById('perf-chart'); if(!c) return;
                const ctx=c.getContext('2d'); c.width=c.offsetWidth; c.height=200;

                // REAL MATH: Simulated edge-native latency based on actual system performance
                // Target: 10-15ms for local inference (realistic for quantized models on Jetson)
                let data = [];
                let baseLatency = 12; // ms - realistic edge inference time
                let time = 0;

                const id = setInterval(() => {
                    if(!document.getElementById('perf-chart')) return;

                    // Realistic variance: +/- 3ms based on CPU load simulation
                    const cpuNoise = (Math.sin(time / 10) * 2) + (Math.random() * 1.5 - 0.75);
                    const latency = baseLatency + cpuNoise;

                    data.push(Math.max(8, Math.min(18, latency))); // Clamp between 8-18ms
                    if(data.length > 50) data.shift();

                    ctx.clearRect(0,0,c.width,c.height);
                    ctx.strokeStyle=getComputedStyle(document.body).getPropertyValue('--primary');
                    ctx.lineWidth=2;
                    ctx.beginPath();

                    for(let i=0; i<data.length; i++) {
                        ctx.lineTo(i*(c.width/50), 200 - (data[i]*10));
                    }
                    ctx.stroke();

                    // Display stats
                    const avg = data.reduce((a,b) => a+b, 0) / data.length;
                    const max = Math.max(...data);
                    ctx.fillStyle = ctx.strokeStyle;
                    ctx.font = '12px monospace';
                    ctx.fillText(`LATENCY: ${Math.round(data[data.length-1])}ms | AVG: ${Math.round(avg)}ms | MAX: ${Math.round(max)}ms`, 10, 20);
                    ctx.fillText(`TARGET: <15ms (Edge-Native Inference)`, 10, 35);

                    time++;
                }, 50);
                this.intervals.push(id);
            },
            drawExecChart: function() {
                const c=document.getElementById('roi-chart'); if(!c) return;
                const ctx=c.getContext('2d'); c.width=c.offsetWidth; c.height=250;

                // REAL MATH: 5-year TCO calculations based on industry benchmarks
                const vertical = State.vertical;

                // Build In-House: 3 engineers @ $150k/yr + infrastructure + failure rate
                const buildCost = {
                    DEFENSE: 2400000,    // 3 engineers * 5 years * $150k + $900k infra + 20% failure premium
                    LOGISTICS: 1800000,  // Same but less security overhead
                    FINANCE: 2100000,    // Higher compliance costs
                    CYBER: 2600000       // Highest security + compliance
                }[vertical] || 2000000;

                // Buy Enterprise: SaaS subscription + implementation + consultants
                const buyCost = {
                    DEFENSE: 3200000,    // Palantir-level pricing: $500k/yr * 5 + $700k implementation
                    LOGISTICS: 2800000,  // SAP/Oracle: $400k/yr * 5 + $800k implementation
                    FINANCE: 3500000,    // Bloomberg Terminal fleet: $600k/yr * 5 + $500k setup
                    CYBER: 2400000       // Splunk: $350k/yr * 5 + $650k setup
                }[vertical] || 3000000;

                // AIME: One-time prototype + optional maintenance
                const aimeCost = 7500; // Base engagement

                // Animate bars growing to their real values
                const maxCost = Math.max(buildCost, buyCost);
                const scale = 200 / maxCost; // Scale to fit chart height

                let h1 = 10, h2 = 10, h3 = 10;
                const targetH1 = buyCost * scale;
                const targetH2 = buildCost * scale;
                const targetH3 = aimeCost * scale;

                const id = setInterval(() => {
                    if(!document.getElementById('roi-chart')) return;

                    // Animate to target heights
                    if(h1 < targetH1) h1 += (targetH1 / 60);
                    if(h2 < targetH2) h2 += (targetH2 / 60);
                    if(h3 < targetH3) h3 += (targetH3 / 60);

                    ctx.clearRect(0,0,c.width,c.height);
                    ctx.font = '11px monospace';

                    // BUILD (Red)
                    ctx.fillStyle = '#FF0000';
                    ctx.fillRect(60, 250-h2, 70, h2);
                    ctx.fillText(`BUILD IN-HOUSE`, 50, 245-h2);
                    ctx.fillText(`$${(buildCost/1000000).toFixed(1)}M / 5yr`, 50, 230-h2);

                    // BUY (Orange)
                    ctx.fillStyle = '#FFA500';
                    ctx.fillRect(180, 250-h1, 70, h1);
                    ctx.fillText(`BUY ENTERPRISE`, 170, 245-h1);
                    ctx.fillText(`$${(buyCost/1000000).toFixed(1)}M / 5yr`, 170, 230-h1);

                    // AIME (Green)
                    ctx.fillStyle = '#00FF41';
                    ctx.fillRect(300, 250-h3, 70, Math.max(h3, 8)); // Min height for visibility
                    ctx.fillText(`AIME PROTO`, 295, 240);
                    ctx.fillText(`$${(aimeCost/1000).toFixed(1)}k`, 300, 225);

                    // ROI Label
                    const roi = Math.round((buildCost / aimeCost));
                    ctx.fillStyle = '#00FF41';
                    ctx.fillText(`ROI: ${roi}x cheaper than building`, 10, 20);
                }, 30);
                this.intervals.push(id);
            },
            startTimer: function() {
                let t=48*60*60; 
                const id = setInterval(()=>{ 
                    if(!document.getElementById('countdown')) return;
                    t--; const h=Math.floor(t/3600),m=Math.floor((t%3600)/60),s=t%60; 
                    document.getElementById('countdown').innerText=`${h}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`; 
                }, 1000);
                this.intervals.push(id);
            }
        };

        // 8. LEAD CAPTURE
        const LeadCapture = {
            targetUrl: '',
            request: function(d, u) {
                State.ingest('click', d.toUpperCase());
                try {
                    if(localStorage.getItem('aime_lead')) {
                        window.open(u, '_blank');
                    } else {
                        this.targetUrl = u;
                        document.getElementById('lead-modal').classList.remove('hidden');
                    }
                } catch(e) {
                    // If localStorage blocked, just open the link directly
                    window.open(u, '_blank');
                }
            },
            submit: function() {
                const email = document.getElementById('lead-email').value;
                if(!email) return;
                try {
                    localStorage.setItem('aime_lead', email);
                } catch(e) {
                    // Silent fail
                }
                document.getElementById('lead-modal').classList.add('hidden');
                window.open(this.targetUrl, '_blank');
            }
        };

        // 9. UTILS
        const Comms = {
            open: function(c, p) { document.getElementById('contact-modal').classList.remove('hidden'); if(c) document.getElementById('contact-mission').value=c; if(p) { const s=document.getElementById('contact-budget'); let o=document.createElement('option'); o.text=`LOCKED: $${p.toLocaleString()}`; o.value='locked'; s.add(o,0); s.value='locked'; }},
            close: () => document.getElementById('contact-modal').classList.add('hidden'),
            transmit: () => { const n=document.getElementById('contact-name').value; const m=document.getElementById('contact-mission').value; const b=document.getElementById('contact-budget').value; const p=`VERTICAL: ${State.vertical} // PERSONA: ${State.persona}`; window.location.href=`mailto:mani@aimeintelligence.com?subject=UPLINK: ${m}&body=ID: ${n}%0D%0AMISSION: ${m}%0D%0ABUDGET: ${b}%0D%0A${p}`; }
        };

        const AudioController = {
            ctx: null,
            muted: (() => {
                try {
                    return localStorage.getItem('aime_mute') === 'true';
                } catch(e) {
                    return false;
                }
            })(),
            init: function() {
                if(this.muted) {
                    document.getElementById('audio-toggle').innerText="AUDIO: OFF";
                    return;
                }
                try{
                    window.AudioContext=window.AudioContext||window.webkitAudioContext;
                    this.ctx=new AudioContext();
                }catch(e){}
            },
            toggle: function() {
                this.muted=!this.muted;
                try {
                    localStorage.setItem('aime_mute', this.muted);
                } catch(e) {}
                document.getElementById('audio-toggle').innerText=this.muted?"AUDIO: OFF":"AUDIO: ON";
                if(!this.muted && !this.ctx) this.init();
            },
            play: function(t) {
                if(this.muted||!this.ctx) return;
                const o=this.ctx.createOscillator();
                const g=this.ctx.createGain();
                o.connect(g);
                g.connect(this.ctx.destination);
                if(t==='click') {
                    o.type='square';
                    o.frequency.setValueAtTime(600, this.ctx.currentTime);
                    g.gain.linearRampToValueAtTime(0.05, this.ctx.currentTime);
                    g.gain.linearRampToValueAtTime(0, this.ctx.currentTime+0.1);
                    o.start();
                    o.stop(this.ctx.currentTime+0.1);
                }
            }
        };

        // 10. BOOT
        const System = {
            boot: function() {
                AudioController.init();
                AudioController.play('click');

                // Apply time decay FIRST before any rendering
                State.applyTimeDecay();

                // LOAD BRAINS
                Profiler.init();
                Calendar.render();
                ContentMorpher.init();
                LossTicker.init();
                HeroRotator.init();
                State.sync();

                // Add click handlers to case study cards to force vertical switching
                document.querySelectorAll('.card-holo[data-semantic]').forEach(card => {
                    card.addEventListener('click', (e) => {
                        // Don't trigger if clicking a button inside the card
                        if (e.target.tagName === 'BUTTON') return;

                        const vertical = card.getAttribute('data-semantic');
                        State.forceVertical(vertical);
                        AudioController.play('click');
                    });
                });

                // Add click handler to doctrine section to rotate verticals
                const doctrineSection = document.getElementById('doctrine-section');
                if (doctrineSection) {
                    doctrineSection.addEventListener('click', (e) => {
                        // Cycle through verticals on click
                        const verticals = ['DEFENSE', 'LOGISTICS', 'FINANCE', 'CYBER'];
                        const currentIndex = verticals.indexOf(State.vertical);
                        const nextIndex = (currentIndex + 1) % verticals.length;
                        State.forceVertical(verticals[nextIndex]);
                        AudioController.play('click');
                    });
                    doctrineSection.style.cursor = 'pointer';
                }

                // UNIVERSAL CLICK HANDLER: Any click on info boxes/CTAs changes content
                const clickableSelectors = [
                    '.capability-card',     // Capability cards
                    '.matrix-box',          // Matrix boxes
                    '.cal-day',             // Calendar days
                    '#debt-clock-section',  // Debt clock section
                    '.dynamic-hero',        // Hero section
                    'section',              // All sections
                    '.box',                 // Info boxes
                    'button',               // All buttons
                    'a.btn-sm',             // CTA buttons
                ];

                clickableSelectors.forEach(selector => {
                    document.querySelectorAll(selector).forEach(element => {
                        element.addEventListener('click', (e) => {
                            // Don't override existing handlers for cards with data-semantic
                            if (element.hasAttribute('data-semantic')) return;

                            // Don't trigger if it's a link that should navigate
                            if (element.tagName === 'A' && element.getAttribute('href') &&
                                !element.getAttribute('href').startsWith('#')) return;

                            // Rotate hero message
                            HeroRotator.cycle();

                            // Rotate capability cards
                            CapabilityRotator.cycle();

                            // Cycle persona
                            const personas = ['COMMANDER', 'TECHNICAL_DECISION_MAKER', 'ENTERPRISE_EXECUTIVE'];
                            const currentIndex = personas.indexOf(State.dossier.persona);
                            const nextIndex = (currentIndex + 1) % personas.length;
                            State.dossier.persona = personas[nextIndex];

                            // Cycle vertical
                            const verticals = ['DEFENSE', 'LOGISTICS', 'FINANCE', 'CYBER'];
                            const currentVerticalIndex = verticals.indexOf(State.vertical);
                            const nextVertical = verticals[(currentVerticalIndex + 1) % verticals.length];
                            State.forceVertical(nextVertical);

                            State.log(`/// CLICK-TRIGGERED ROTATION: ${personas[nextIndex]} / ${nextVertical}`);
                            AudioController.play('click');
                        }, { once: false });
                    });
                });

                // PRICING BOX CLICK HANDLER: Scroll to calendar when clicking any pricing option
                // Use event delegation since matrix-cards are dynamically generated
                document.addEventListener('click', (e) => {
                    const matrixCard = e.target.closest('.matrix-card');
                    if (matrixCard) {
                        // Find the calendar section
                        const calendarSection = document.querySelector('.cal-grid');
                        if (calendarSection) {
                            // Smooth scroll to calendar
                            calendarSection.scrollIntoView({
                                behavior: 'smooth',
                                block: 'center'
                            });

                            // Visual feedback - highlight calendar briefly
                            const calGrid = document.getElementById('cal-grid');
                            if (calGrid) {
                                calGrid.style.transition = 'all 0.3s ease';
                                calGrid.style.transform = 'scale(1.02)';
                                calGrid.style.boxShadow = '0 0 30px rgba(0,255,65,0.3)';

                                setTimeout(() => {
                                    calGrid.style.transform = 'scale(1)';
                                    calGrid.style.boxShadow = 'none';
                                }, 600);
                            }

                            State.log('/// PRICING BOX CLICKED: NAVIGATING TO CALENDAR');
                            AudioController.play('click');
                        }
                    }
                });

                // TYPEWRITER EFFECT
                const h1 = document.querySelector('.dynamic-hero');
                // Only run effect if text is default
                if(h1.innerText.includes("Your Internal Teams")) {
                    const txt = h1.innerHTML;
                    h1.innerHTML='';
                    let i=0;
                    const t = setInterval(() => {
                        if(i >= txt.length) { clearInterval(t); h1.classList.add('typing-cursor'); return; }
                        if(txt[i] === '<') {
                            const close = txt.indexOf('>', i);
                            h1.innerHTML += txt.substring(i, close+1);
                            i = close + 1;
                        } else {
                            h1.innerHTML += txt[i];
                            i++;
                        }
                    }, 30);
                }

                // OPTIMIZED SIM LOOP
                setInterval(() => {
                    document.getElementById('active-count').innerText = 12 + Math.floor(Math.random()*5);
                }, 3000);

                // CONTINUOUS TIME DECAY (check every 60 seconds)
                setInterval(() => {
                    const now = Date.now();
                    const lastActive = State.dossier.lastActive || now;
                    const secondsIdle = (now - lastActive) / 1000;

                    // If idle for more than 30 seconds, slowly decay erratic behavior
                    if (secondsIdle > 30 && State.dossier.behaviors.erratic > 0) {
                        State.dossier.behaviors.erratic = Math.max(0, State.dossier.behaviors.erratic - 1);
                        State.computePersona();
                        State.save();
                        State.sync();
                    }
                }, 60000); // Check every minute

                // AUTO-ROTATION: Cycle through personas every 15 seconds
                // This ensures the site is ALWAYS morphing and showing different sales angles
                const personas = ['COMMANDER', 'TECHNICAL_DECISION_MAKER', 'ENTERPRISE_EXECUTIVE'];
                let autoRotateIndex = 0;
                let lastManualInteraction = Date.now();
                let lastPersonaChange = Date.now();
                let lastScrollActivity = Date.now();
                let lastScrollY = window.scrollY;

                // Track manual interactions (clicks only, not scrolling)
                document.addEventListener('click', () => {
                    lastManualInteraction = Date.now();
                });

                // Track slow scrolling (user is reading) - reset rotation timer
                window.addEventListener('scroll', () => {
                    const now = Date.now();
                    const currentScrollY = window.scrollY;
                    const scrollDistance = Math.abs(currentScrollY - lastScrollY);

                    // If user is scrolling slowly (reading), reset interaction timer
                    // Slow scroll = less than 500px movement
                    if (scrollDistance > 10 && scrollDistance < 500) {
                        lastScrollActivity = now;
                        lastManualInteraction = now; // Treat reading as active engagement
                    }

                    lastScrollY = currentScrollY;
                }, { passive: true });

                setInterval(() => {
                    const now = Date.now();
                    const secondsSinceClick = (now - lastManualInteraction) / 1000;
                    const secondsSincePersonaChange = (now - lastPersonaChange) / 1000;

                    // FORCE ROTATION if stuck on same persona for >30 seconds
                    if (secondsSincePersonaChange > 30) {
                        autoRotateIndex = (autoRotateIndex + 1) % personas.length;
                        State.dossier.persona = personas[autoRotateIndex];
                        State.log(`/// FORCE ROTATE: ${personas[autoRotateIndex]} MODE (STUCK OVERRIDE)`);
                        lastPersonaChange = now;
                        State.sync();
                        return;
                    }

                    // Normal rotation: Only skip if user is actively engaged (clicking or reading)
                    // Now includes slow scrolling detection - won't rotate while user is reading
                    if (State.dossier.persona !== 'CRISIS_BUYER' && secondsSinceClick > 3) {
                        // Find current persona in array
                        const currentPersonaIndex = personas.indexOf(State.dossier.persona);
                        if (currentPersonaIndex !== -1) {
                            autoRotateIndex = currentPersonaIndex;
                        }

                        autoRotateIndex = (autoRotateIndex + 1) % personas.length;
                        State.dossier.persona = personas[autoRotateIndex];
                        State.log(`/// AUTO-ROTATE: ${personas[autoRotateIndex]} MODE`);
                        lastPersonaChange = now;
                        State.sync();
                    }
                }, 15000); // Rotate every 15 seconds

                // AUTO-ROTATE VERTICALS: Cycle through verticals every 12 seconds
                const verticals = ['DEFENSE', 'LOGISTICS', 'FINANCE', 'CYBER'];
                let verticalRotateIndex = 0;
                let lastVerticalChange = Date.now();

                setInterval(() => {
                    const now = Date.now();
                    const secondsSinceClick = (now - lastManualInteraction) / 1000;
                    const secondsSinceVerticalChange = (now - lastVerticalChange) / 1000;

                    // FORCE ROTATION if stuck on same vertical for >25 seconds
                    if (secondsSinceVerticalChange > 25) {
                        verticalRotateIndex = (verticalRotateIndex + 1) % verticals.length;
                        State.forceVertical(verticals[verticalRotateIndex]);
                        State.log(`/// FORCE ROTATE: ${verticals[verticalRotateIndex]} VERTICAL (STUCK OVERRIDE)`);
                        lastVerticalChange = now;
                        return;
                    }

                    // Normal rotation: Only skip if user clicked within last 3 seconds
                    if (secondsSinceClick > 3) {
                        // Find current vertical in array
                        const currentVertical = State.vertical;
                        const currentVerticalIndex = verticals.indexOf(currentVertical);
                        if (currentVerticalIndex !== -1) {
                            verticalRotateIndex = currentVerticalIndex;
                        }

                        verticalRotateIndex = (verticalRotateIndex + 1) % verticals.length;
                        State.forceVertical(verticals[verticalRotateIndex]);
                        lastVerticalChange = now;
                    }
                }, 12000); // Rotate verticals every 12 seconds
            }
        };

        // AUTO-BOOT on page load
        window.addEventListener('DOMContentLoaded', () => {
            // Check for reset flag in URL - MUST BE FIRST
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('reset') === '1') {
                try {
                    // Clear localStorage FIRST
                    localStorage.clear();

                    // CRITICAL: Reinitialize State.dossier from scratch
                    // (it was already loaded with old data when script initialized)
                    State.dossier = {
                        scores: { DEFENSE: 0, LOGISTICS: 0, FINANCE: 0, CYBER: 0 },
                        behaviors: { erratic: 0, stress: 0 },
                        persona: 'COMMANDER',
                        lastActive: Date.now()
                    };

                    // Clear the ContentMorpher injection cache
                    if (typeof ContentMorpher !== 'undefined') {
                        ContentMorpher.injected.clear();
                    }

                    State.save();
                } catch(e) {}
            }

            // Check if localStorage is available
            try {
                localStorage.setItem('aime_test', 'test');
                localStorage.removeItem('aime_test');
                // If we can access localStorage, auto-boot after brief delay
                setTimeout(() => System.boot(), 500);
            } catch(e) {
                // If localStorage is blocked, show a warning but still boot
                console.warn('LocalStorage blocked - behavioral tracking disabled');
                setTimeout(() => System.boot(), 500);
            }
        });

        document.addEventListener('mouseleave', e => { if(e.clientY<0) document.getElementById('exit-modal').classList.remove('hidden'); });
        document.querySelectorAll('.btn, .card-holo, .cal-day').forEach(el => { el.addEventListener('mouseenter', ()=>AudioController.play('hover')); el.addEventListener('click', ()=>AudioController.play('click')); });

    </script>

    <!-- WEAPONIZED MOTION ENGINE -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/ScrollTrigger.min.js"></script>
    <script src="https://unpkg.com/split-type"></script>

    <script>
        // =================================================================
        // 11. KINETIC WARFARE ENGINE (GSAP + DECRYPTION)
        // =================================================================

        gsap.registerPlugin(ScrollTrigger);

        const KineticWarfare = {
            chars: "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789$#@%&",

            init: function() {
                this.initScrollTriggers();
                this.initHighlightTargeting();
                this.initClassifiedRedaction();
            },

            // 1. The "J.A.R.V.I.S." Decryption Effect
            // Usage: KineticWarfare.decrypt(element, "New Text to Show");
            decrypt: function(element, finalText) {
                if(!element) return;

                // If it's currently animating, kill it to prevent overlap
                if(element.dataset.animating === "true") return;
                element.dataset.animating = "true";

                let iterations = 0;
                const originalText = finalText || element.innerText;

                // Speed varies by persona (Crisis = Fast/Glitchy, Exec = Slow/Smooth)
                const speed = typeof State !== 'undefined' && State.dossier.persona === 'CRISIS_BUYER' ? 15 : 30;

                const interval = setInterval(() => {
                    element.innerText = originalText
                        .split("")
                        .map((letter, index) => {
                            if(index < iterations) {
                                return originalText[index];
                            }
                            return this.chars[Math.floor(Math.random() * 41)];
                        })
                        .join("");

                    if(iterations >= originalText.length) {
                        clearInterval(interval);
                        element.innerText = originalText; // Ensure clean final state
                        element.dataset.animating = "false";
                    }

                    iterations += 1 / 2; // Decryption smoothness
                }, speed);
            },

            // 2. Scroll Triggers (Things animate when you look at them)
            initScrollTriggers: function() {
                // Cards slide up with military precision stagger
                gsap.from(".card-holo", {
                    scrollTrigger: {
                        trigger: ".grid",
                        start: "top 80%",
                    },
                    y: 100,
                    opacity: 0,
                    duration: 0.8,
                    stagger: 0.15,
                    ease: "power4.out"
                });

                // Capability List items snap in
                const capabilityGrid = document.querySelector(".capability-grid");
                if(capabilityGrid) {
                    gsap.from(".capability-grid > div", {
                        scrollTrigger: {
                            trigger: ".capability-grid",
                            start: "top 85%",
                        },
                        x: -50,
                        opacity: 0,
                        duration: 0.6,
                        stagger: 0.1,
                        ease: "back.out(1.7)" // Mechanical snap effect
                    });
                }

                // The Loss Ticker counts up visually when viewed
                const tickerVal = document.getElementById('ticker-val');
                if(tickerVal) {
                    ScrollTrigger.create({
                        trigger: ".loss-ticker",
                        start: "top 75%",
                        onEnter: () => {
                            // Reset and rapid count up
                            let obj = { val: 0 };
                            let target = parseInt(tickerVal.innerText.replace(/,/g, '')) || 50000;

                            gsap.to(obj, {
                                val: target,
                                duration: 2,
                                ease: "expo.out",
                                onUpdate: function() {
                                    tickerVal.innerText = Math.floor(obj.val).toLocaleString();
                                }
                            });
                        }
                    });
                }

                // Matrix cards stagger in
                gsap.from(".matrix-card", {
                    scrollTrigger: {
                        trigger: ".matrix-grid",
                        start: "top 80%",
                    },
                    y: 50,
                    opacity: 0,
                    duration: 0.6,
                    stagger: 0.1,
                    ease: "power3.out"
                });
            },

            // 3. Intelligent Highlighting (Wraps key terms in targeting brackets)
            initHighlightTargeting: function() {
                // Find numbers and keywords and wrap them
                const keywords = ["\\$7,500", "48 Hours", "48 hours", "Zero Risk", "15ms", "ROI"];

                // Target specific elements to be safe
                const targetSelectors = ['.hero-sub', '.matrix-body'];

                targetSelectors.forEach(selector => {
                    const elements = document.querySelectorAll(selector);
                    elements.forEach(el => {
                        let html = el.innerHTML;
                        keywords.forEach(keyword => {
                            const regex = new RegExp(`(${keyword})`, 'gi');
                            html = html.replace(regex, '<span class="tactical-highlight">$1</span>');
                        });
                        el.innerHTML = html;
                    });
                });

                // Animate highlights when scrolled into view
                gsap.utils.toArray(".tactical-highlight").forEach(highlight => {
                    ScrollTrigger.create({
                        trigger: highlight,
                        start: "top 85%",
                        onEnter: () => highlight.classList.add("locked"),
                        onLeaveBack: () => highlight.classList.remove("locked")
                    });
                });
            },

            // 4. CLASSIFIED REDACTION SYSTEM (CIA Document Effect)
            initClassifiedRedaction: function() {
                // Words to BLACK OUT (boring/negative words)
                const censorWords = [
                    "discovery", "planning", "meetings", "committee", "approval", "slow",
                    "waiting", "traditional", "agencies", "months", "quarters", "vendors",
                    "procurement", "bureaucracy", "delay", "complicated"
                ];

                // Words to REVEAL with glow (motivating action words)
                const revealWords = [
                    "48 hours", "deploy", "ship", "immediate", "tonight", "now",
                    "operational", "live", "zero risk", "guaranteed", "own the code",
                    "full refund", "exclusive", "limited", "surge", "emergency"
                ];

                // Target sections for redaction
                const targetSections = ['.hero-sub', '.matrix-body', '.loss-ticker', '#doctrine-section p'];

                targetSections.forEach(selector => {
                    const elements = document.querySelectorAll(selector);
                    elements.forEach(el => {
                        let html = el.innerHTML;

                        // Apply CENSORSHIP to boring words
                        censorWords.forEach(word => {
                            const regex = new RegExp(`\\b(${word})\\b`, 'gi');
                            html = html.replace(regex, '<span class="censored">$1</span>');
                        });

                        // Apply REVEAL to action words
                        revealWords.forEach(word => {
                            const regex = new RegExp(`\\b(${word})\\b`, 'gi');
                            html = html.replace(regex, '<span class="redacted">$1</span>');
                        });

                        el.innerHTML = html;
                    });
                });

                // ACTIVE DECLASSIFICATION: Reveal power words as you scroll down, hide as you scroll up
                gsap.utils.toArray(".redacted").forEach((word, index) => {
                    ScrollTrigger.create({
                        trigger: word,
                        start: "top 80%",
                        end: "bottom 20%",
                        onEnter: () => {
                            // Active reveal animation as user scrolls DOWN
                            setTimeout(() => {
                                word.classList.remove("reclassifying");
                                word.classList.add("revealing");
                                setTimeout(() => {
                                    word.classList.remove("revealing");
                                    word.classList.add("revealed");
                                    // Add pulse after reveal
                                    setTimeout(() => word.classList.add("keyword-pulse"), 300);
                                }, 500);
                            }, index * 100); // Stagger the reveals
                        },
                        onLeaveBack: () => {
                            // Re-classify when scrolling UP (power words get hidden again)
                            setTimeout(() => {
                                word.classList.remove("revealed");
                                word.classList.remove("keyword-pulse");
                                word.classList.add("reclassifying");
                                setTimeout(() => {
                                    word.classList.remove("reclassifying");
                                }, 500);
                            }, index * 80);
                        },
                        onEnterBack: () => {
                            // Reveal again when scrolling back down
                            setTimeout(() => {
                                word.classList.remove("reclassifying");
                                word.classList.add("revealing");
                                setTimeout(() => {
                                    word.classList.remove("revealing");
                                    word.classList.add("revealed");
                                    word.classList.add("keyword-pulse");
                                }, 500);
                            }, index * 100);
                        }
                    });
                });

                // ACTIVE BLACKOUT: Classify words as you scroll down, declassify as you scroll up
                gsap.utils.toArray(".censored").forEach((word, index) => {
                    ScrollTrigger.create({
                        trigger: word,
                        start: "top 75%",
                        end: "bottom 25%",
                        onEnter: () => {
                            // Actively black out the word with animation as user scrolls DOWN
                            setTimeout(() => {
                                word.classList.remove("declassified");
                                word.classList.add("active-blackout");
                                setTimeout(() => {
                                    word.classList.remove("active-blackout");
                                    word.classList.add("classified");
                                }, 400);
                            }, index * 80); // Stagger the blackouts
                        },
                        onLeave: () => {
                            // Keep it classified when scrolling past
                            word.classList.add("classified");
                        },
                        onEnterBack: () => {
                            // Re-classify when scrolling back down
                            word.classList.remove("declassified");
                            word.classList.add("classified");
                        },
                        onLeaveBack: () => {
                            // Declassify when scrolling UP (reverse the blackout)
                            setTimeout(() => {
                                word.classList.remove("classified");
                                word.classList.remove("active-blackout");
                                word.classList.add("declassified");
                            }, index * 60);
                        }
                    });
                });

                // Yellow highlighter effect for pricing
                const highlightPricing = ['$7,500', '$9,800', '$12,950', '48-hour'];
                const pricingSections = ['.matrix-card', '.hero-sub'];

                pricingSections.forEach(selector => {
                    document.querySelectorAll(selector).forEach(el => {
                        let html = el.innerHTML;
                        highlightPricing.forEach(term => {
                            const regex = new RegExp(`(${term.replace(/\$/g, '\\$')})`, 'gi');
                            html = html.replace(regex, '<span class="classified-highlight">$1</span>');
                        });
                        el.innerHTML = html;
                    });
                });

                // Trigger highlighter animation on scroll
                gsap.utils.toArray(".classified-highlight").forEach(highlight => {
                    ScrollTrigger.create({
                        trigger: highlight,
                        start: "top 80%",
                        onEnter: () => {
                            setTimeout(() => highlight.classList.add("marked"), 200);
                        }
                    });
                });
            }
        };

        // --- HOOK INTO THE SYSTEM BOOT ---
        // Wait for GSAP to load and for DOM to be ready
        window.addEventListener('load', () => {
            setTimeout(() => {
                if(typeof gsap !== 'undefined') {
                    KineticWarfare.init();
                }
            }, 1500);
        });

        // --- OVERRIDE THE RENDERER TO USE DECRYPTION ---
        // We are monkey-patching your Renderer to use the cool text effect
        let isInitialLoad = true; // Track if this is the first load

        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                if(typeof Renderer !== 'undefined' && typeof KineticWarfare !== 'undefined') {
                    const originalUpdateContent = Renderer.updateContent;

                    Renderer.updateContent = function(persona, vertical) {
                        // Call original first to set up variables
                        originalUpdateContent.call(Renderer, persona, vertical);

                        // Skip decryption on initial load (let typewriter run)
                        if(isInitialLoad) {
                            isInitialLoad = false;
                            return;
                        }

                        // NOW, Apply the Decryption Effect to the Headlines (only on persona changes)
                        setTimeout(() => {
                            const heroH1 = document.querySelector('.dynamic-hero');
                            const heroSub = document.querySelector('.dynamic-subhero');

                            if(heroH1) KineticWarfare.decrypt(heroH1);
                            if(heroSub) KineticWarfare.decrypt(heroSub);

                            // Also decrypt the Matrix Card titles
                            document.querySelectorAll('.matrix-title').forEach(el => {
                                KineticWarfare.decrypt(el);
                            });
                        }, 50);
                    };
                }
            }, 2000);
        });
    </script>

</body>
</html>